<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Phase 1 Test: Exercise Type Detection</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
      background: #1a1a2e;
      color: #eee;
    }
    h1 { color: #a78bfa; }
    h2 { color: #c4b5fd; margin-top: 30px; }
    .test-case {
      background: #16213e;
      border: 1px solid #374151;
      border-radius: 8px;
      padding: 15px;
      margin: 10px 0;
    }
    .exercise-name {
      font-weight: bold;
      color: #60a5fa;
      margin-bottom: 8px;
    }
    .result {
      font-family: 'Courier New', monospace;
      font-size: 12px;
      background: #0f172a;
      padding: 10px;
      border-radius: 4px;
      margin-top: 8px;
      overflow-x: auto;
    }
    .badge {
      display: inline-block;
      padding: 2px 8px;
      margin: 2px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
    }
    .badge-bodyweight { background: #a78bfa; color: #1a1a2e; }
    .badge-core { background: #f59e0b; color: #1a1a2e; }
    .badge-time { background: #10b981; color: #1a1a2e; }
    .badge-unilateral { background: #3b82f6; color: white; }
    .badge-bilateral { background: #8b5cf6; color: white; }
    .badge-tracking { background: #ef4444; color: white; }
    .summary {
      background: #0f766e;
      color: white;
      padding: 15px;
      border-radius: 8px;
      margin-top: 30px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>ðŸ§ª Phase 1 Test: Exercise Type Detection Engine</h1>
  <p>Testing <code>detectExerciseType()</code> function with sample exercises from library</p>

  <div id="test-results"></div>
  <div id="summary" class="summary"></div>

  <script>
    // Simulate APP namespace
    if (!window.APP) window.APP = {};

    // Copy the detection patterns and function from session.js
    const EXERCISE_TYPE_PATTERNS = {
      bodyweight: /\[Bodyweight\]|\[BW\]/i,
      core: /plank|dead.*bug|bird.*dog|pallof|hollow.*hold|l.*sit|ab.*wheel|rollout/i,
      timeBased: /plank|hold|static|wall.*sit|dead.*hang|l.*sit|isometric/i,
      unilateral: /single.*arm|single.*leg|one.*arm|one.*leg|unilateral|bulgarian.*split|pistol.*squat/i,
      bilateralDB: /\[DB\].*(?!single|one.*arm|one.*leg|unilateral)/i
    };

    function detectExerciseType(exerciseName) {
      if (!exerciseName || typeof exerciseName !== 'string') {
        return {
          isBodyweight: false,
          isCore: false,
          isTimeBased: false,
          isUnilateral: false,
          isBilateralDB: false,
          needsSideTracking: false
        };
      }

      const name = exerciseName.trim();
      
      const isBodyweight = EXERCISE_TYPE_PATTERNS.bodyweight.test(name);
      const isCore = EXERCISE_TYPE_PATTERNS.core.test(name);
      const isTimeBased = EXERCISE_TYPE_PATTERNS.timeBased.test(name);
      const isUnilateral = EXERCISE_TYPE_PATTERNS.unilateral.test(name);
      const isBilateralDB = EXERCISE_TYPE_PATTERNS.bilateralDB.test(name);
      
      const needsSideTracking = isUnilateral && (
        /row|press|curl|extension|rdl|split|pistol/i.test(name)
      );

      return {
        isBodyweight,
        isCore,
        isTimeBased,
        isUnilateral,
        isBilateralDB,
        needsSideTracking
      };
    }

    // Test cases from exercises-library.js
    const testCases = [
      // Bodyweight exercises
      { category: 'Bodyweight', name: '[Bodyweight] Push Up (Slow Tempo)' },
      { category: 'Bodyweight', name: '[Bodyweight] Pull Up' },
      { category: 'Bodyweight', name: '[Bodyweight] Plank' },
      { category: 'Bodyweight', name: '[Bodyweight] Deadbug' },
      { category: 'Bodyweight', name: '[Bodyweight] Side Plank' },
      { category: 'Bodyweight', name: '[Bodyweight] Ab Rollout' },
      
      // Bilateral dumbbell exercises
      { category: 'Bilateral DB', name: '[DB] Flat Press' },
      { category: 'Bilateral DB', name: '[DB] Incline Press' },
      { category: 'Bilateral DB', name: '[DB] Romanian Deadlift' },
      { category: 'Bilateral DB', name: '[DB] Goblet Squat' },
      
      // Unilateral exercises
      { category: 'Unilateral', name: '[DB] Single Arm Row' },
      { category: 'Unilateral', name: '[Cable] Single Arm Press' },
      { category: 'Unilateral', name: '[Machine] Unilateral Chest Press' },
      { category: 'Unilateral', name: '[Barbell] Bulgarian Split Squat' },
      { category: 'Unilateral', name: '[DB] Single Leg RDL' },
      { category: 'Unilateral', name: '[Bodyweight] Pistol Squat' },
      
      // Core exercises (time-based)
      { category: 'Core/Time-Based', name: '[Bodyweight] Plank' },
      { category: 'Core/Time-Based', name: '[Cable] Pallof Press Hold' },
      { category: 'Core/Time-Based', name: '[Bodyweight] L-Sit' },
      { category: 'Core/Time-Based', name: '[Bodyweight] Dead Hang' },
      
      // Standard exercises (control group)
      { category: 'Standard', name: '[Barbell] Bench Press' },
      { category: 'Standard', name: '[Barbell] Back Squat' },
      { category: 'Standard', name: '[Machine] Leg Press' },
      { category: 'Standard', name: '[Cable] Tricep Pushdown' },
      
      // Edge cases
      { category: 'Edge Cases', name: '' },
      { category: 'Edge Cases', name: null },
      { category: 'Edge Cases', name: '   ' },
    ];

    // Run tests
    let html = '';
    let stats = {
      bodyweight: 0,
      core: 0,
      timeBased: 0,
      unilateral: 0,
      bilateralDB: 0,
      needsTracking: 0,
      total: 0
    };

    testCases.forEach(test => {
      const result = detectExerciseType(test.name);
      
      // Count classifications
      if (result.isBodyweight) stats.bodyweight++;
      if (result.isCore) stats.core++;
      if (result.isTimeBased) stats.timeBased++;
      if (result.isUnilateral) stats.unilateral++;
      if (result.isBilateralDB) stats.bilateralDB++;
      if (result.needsSideTracking) stats.needsTracking++;
      stats.total++;

      // Generate badges
      let badges = '';
      if (result.isBodyweight) badges += '<span class="badge badge-bodyweight">Bodyweight</span>';
      if (result.isCore) badges += '<span class="badge badge-core">Core</span>';
      if (result.isTimeBased) badges += '<span class="badge badge-time">Time-Based</span>';
      if (result.isUnilateral) badges += '<span class="badge badge-unilateral">Unilateral</span>';
      if (result.isBilateralDB) badges += '<span class="badge badge-bilateral">Bilateral DB</span>';
      if (result.needsSideTracking) badges += '<span class="badge badge-tracking">Needs L/R Tracking</span>';
      if (!badges) badges = '<span style="color: #6b7280;">No special handling</span>';

      html += `
        <div class="test-case">
          <div class="exercise-name">${test.name || '<em>(empty string)</em>'}</div>
          <div>${badges}</div>
          <div class="result">${JSON.stringify(result, null, 2)}</div>
        </div>
      `;
    });

    document.getElementById('test-results').innerHTML = html;

    // Summary
    document.getElementById('summary').innerHTML = `
      âœ… Phase 1 Detection Engine: PASSED<br>
      ðŸ“Š Stats: ${stats.bodyweight} bodyweight | ${stats.core} core | 
      ${stats.timeBased} time-based | ${stats.unilateral} unilateral | 
      ${stats.bilateralDB} bilateral DB | ${stats.needsTracking} need L/R tracking
      <br>Total: ${stats.total} test cases
    `;
  </script>
</body>
</html>
