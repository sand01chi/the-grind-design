<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <link rel="icon" type="image/png" href="app-logo.png" />
    <link rel="apple-touch-icon" href="app-logo.png" />
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#000000" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-status-bar-style" content="black-translucent" />
    <title>THE GRIND DESIGN V30.0 MOBILE UI</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

    <!-- Tailwind Custom Configuration for V30.0 Mobile UI -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              app: {
                bg: '#000000',           // Pure black background
                card: '#1C1C1E',         // Dark card background
                accent: '#4FD1C5',       // Teal accent (primary actions)
                'accent-dim': 'rgba(79, 209, 197, 0.15)', // Teal background dim
                text: '#FFFFFF',         // Primary text
                subtext: '#9CA3AF',      // Secondary text (gray-400)
              }
            },
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
            },
            boxShadow: {
              'glow': '0 0 15px rgba(79, 209, 197, 0.3)',
              'inner-glow': 'inset 0 0 20px rgba(79, 209, 197, 0.2)',
            }
          }
        }
      }
    </script>
    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
    <!-- Font Awesome 6.4.0 -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/locale/id.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/relativeTime.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      /* ========================================
         V30.0 MOBILE UI - PURE BLACK THEME
         ======================================== */

      :root {
        /* V30.0 Pure Black Theme */
        --glass-bg: rgba(28, 28, 30, 0.95); /* #1C1C1E with opacity */
        --glass-border: rgba(255, 255, 255, 0.1);
        --glass-highlight: rgba(255, 255, 255, 0.05);
        --glass-blur: 16px;
        --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.6);
        --glass-text-secondary: rgba(148, 163, 184, 0.8);
        --primary-glow: rgba(79, 209, 197, 0.2); /* Teal glow */
        --primary-color: #4FD1C5; /* Teal accent */
      }

      body {
        /* V30.0 Pure Black Background */
        background: #000000;
        background-attachment: fixed;
        color: #ffffff;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif;
        -webkit-font-smoothing: antialiased;
        -webkit-tap-highlight-color: transparent;
        padding-bottom: env(safe-area-inset-bottom);
      }

      /* Hide scrollbar for cleaner mobile look */
      ::-webkit-scrollbar {
        display: none;
      }

      /* Spontaneous button glow effect (V30.0) */
      .spontaneous-btn-bg {
        background: linear-gradient(90deg, #111827 0%, rgba(45, 212, 191, 0.15) 50%, #111827 100%);
        border: 1px solid rgba(45, 212, 191, 0.4);
        box-shadow: 0 0 15px rgba(79, 209, 197, 0.15);
      }

      /* Next badge positioning (V30.0) */
      .next-badge {
        position: absolute;
        top: -12px;
        left: 16px;
        padding: 2px 12px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
        background-color: #4FD1C5;
        color: #000000;
        z-index: 10;
      }

      /* Bottom nav styles (V30.0) */
      .nav-item {
        transition: color 0.2s;
      }

      .nav-item-active i {
        filter: drop-shadow(0 0 5px rgba(79, 209, 197, 0.6));
      }

      .nav-item:not(.nav-item-active):hover {
        color: #9CA3AF;
      }

      /* Button transitions (V30.0) */
      button {
        font-family: 'Inter', sans-serif;
        transition: all 0.2s;
      }

      button:active {
        transform: scale(0.98);
      }

      /* Modal styling (V30.0) */
      .modal-backdrop {
        background-color: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(4px);
      }

      .modal-content {
        background-color: #1C1C1E;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 24px;
      }

      /* Global Glass Utilities */
      .glass-panel {
        background: var(--glass-bg);
        backdrop-filter: blur(var(--glass-blur));
        -webkit-backdrop-filter: blur(var(--glass-blur));
        border: 1px solid var(--glass-border);
        box-shadow: var(--glass-shadow);
      }

      .glass-card {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
        transition: transform 0.2s, box-shadow 0.2s;
      }
      
      .glass-card:active {
        transform: scale(0.98);
      }

      .glass-input {
        background: rgba(15, 23, 42, 0.6) !important;
        border: 1px solid var(--glass-border) !important;
        color: white !important;
        backdrop-filter: blur(4px);
        min-height: 44px; /* Touch target size */
      }

      .glass-input:focus {
        border-color: var(--primary-color) !important;
        box-shadow: 0 0 0 2px var(--primary-glow) !important;
      }
      
      .glass-btn {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(4px);
        transition: all 0.2s;
        min-height: 44px; /* Touch target size */
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }
      
      .glass-btn:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.2);
      }
      
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }

      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }

      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: #10b981;
        background-color: #1e293b;
      }

      select {
        appearance: none;
        background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%2334d399%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
        background-repeat: no-repeat;
        background-position: right 0.2rem top 50%;
        background-size: 0.5rem auto;
      }

      .fade-in {
        animation: fadeIn 0.3s ease-out forwards;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .pulse-border {
        animation: pulse-green 2s infinite;
        box-shadow: 0 0 15px var(--primary-glow);
      }
      
      @keyframes pulse-green {
        0% { border-color: rgba(16, 185, 129, 0.4); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
        70% { border-color: rgba(16, 185, 129, 0); box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
        100% { border-color: rgba(16, 185, 129, 0); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
      }

      .focus-active .exercise-card {
        display: none;
      }

      .focus-active .exercise-card.active-card {
        display: block;
      }

      .plate-badge {
        display: inline-block;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 9px;
        font-weight: bold;
        margin-right: 2px;
        color: #1e293b;
      }

      .plate-20 {
        background-color: #3b82f6;
      }

      .plate-15 {
        background-color: #eab308;
      }

      .plate-10 {
        background-color: #22c55e;
      }

      .plate-5 {
        background-color: #fca5a5;
      }

      .plate-2_5 {
        background-color: #cbd5e1;
      }

      .plate-1_25 {
        background-color: #f1f5f9;
      }

      .cardio-card {
        background: linear-gradient(
          135deg,
          rgba(59, 130, 246, 0.1),
          rgba(99, 102, 241, 0.05)
        );
        border: 1px solid rgba(59, 130, 246, 0.3) !important;
        backdrop-filter: blur(5px);
      }

      .cardio-card .exercise-card {
        border-color: rgba(59, 130, 246, 0.3);
      }

      .cardio-header {
        background: rgba(59, 130, 246, 0.1);
        border-bottom: 1px solid rgba(59, 130, 246, 0.2);
      }

      .duration-preset-btn {
        background: rgba(255, 255, 255, 0.05);
        color: #94a3b8;
        border: 1px solid rgba(255, 255, 255, 0.1);
        padding: 8px 16px;
        border-radius: 8px;
        font-size: 12px;
        font-weight: bold;
        transition: all 0.2s;
      }

      .duration-preset-btn.active {
        background: rgba(59, 130, 246, 0.3);
        color: white;
        border-color: #3b82f6;
        box-shadow: 0 0 10px rgba(59, 130, 246, 0.2);
      }

      .duration-preset-btn:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      .hr-zone-valid {
        color: #10b981;
        font-weight: bold;
        text-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
      }

      .hr-zone-warning {
        color: #f59e0b;
        font-weight: bold;
      }

      .hr-zone-invalid {
        color: #ef4444;
        font-weight: bold;
      }

      .quick-note-badge {
        background: rgba(51, 65, 85, 0.5);
        color: #94a3b8;
        border: 1px solid rgba(71, 85, 105, 0.5);
        padding: 6px 12px;
        border-radius: 8px;
        font-size: 11px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .quick-note-badge:hover,
      .quick-note-badge.active {
        background: rgba(59, 130, 246, 0.3);
        color: white;
        border-color: #3b82f6;
      }

      .cardio-complete-summary {
        background: linear-gradient(
          135deg,
          rgba(59, 130, 246, 0.3),
          rgba(99, 102, 241, 0.15)
        );
        border: 1px solid rgba(59, 130, 246, 0.6);
        padding: 20px;
        border-radius: 12px;
        animation: completePulse 0.5s ease-out;
        backdrop-filter: blur(5px);
      }

      #toast-container {
        position: fixed;
        bottom: 80px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 1000;
        pointer-events: none;
        width: 90%;
        max-width: 400px;
        display: flex;
        display: flex;
        flex-direction: column-reverse;
        gap: 8px;
      }

      .toast {
        background: rgba(15, 23, 42, 0.85);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        padding: 12px 16px;
        display: flex;
        align-items: center;
        gap: 12px;
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.6);
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        pointer-events: auto;
      }

      .toast.show {
        opacity: 1;
        transform: translateY(0);
      }

      .toast-success {
        border-color: rgba(16, 185, 129, 0.5);
        background: linear-gradient(to right, rgba(16, 185, 129, 0.1), rgba(15, 23, 42, 0.9));
      }

      .toast-warning {
        border-color: rgba(245, 158, 11, 0.5);
        background: linear-gradient(to right, rgba(245, 158, 11, 0.1), rgba(15, 23, 42, 0.9));
      }

      .toast-icon {
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        font-size: 12px;
        flex-shrink: 0;
      }

      .toast-success .toast-icon {
        background: rgba(16, 185, 129, 0.2);
        color: #10b981;
      }

      .toast-warning .toast-icon {
        background: rgba(245, 158, 11, 0.2);
        color: #f59e0b;
      }

      .hist-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }

      .hist-table th {
        font-size: 10px;
        color: #94a3b8;
        font-weight: bold;
        text-align: left;
        padding: 6px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .hist-table td {
        font-size: 11px;
        color: #e2e8f0;
        padding: 8px 6px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      }

      .hist-table tr:last-child td {
        border-bottom: none;
      }

      /* V30.0 Phase 4: Analytics Tab Buttons - Teal Accent */
      .tab-btn {
        position: relative;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid transparent;
        border-radius: 12px;
      }

      .tab-btn.active {
        background-color: rgba(79, 209, 197, 0.15);
        color: #4FD1C5;
        transform: scale(1.05);
        backdrop-filter: blur(4px);
        box-shadow: 0 4px 12px rgba(79, 209, 197, 0.2);
        border-color: rgba(79, 209, 197, 0.4);
      }

      .tab-btn.inactive {
        background-color: rgba(255, 255, 255, 0.05);
        color: #9CA3AF;
        transform: scale(1);
      }

      .tab-btn.inactive:hover {
        background-color: rgba(255, 255, 255, 0.08);
        color: #FFFFFF;
      }

      .tab-btn.inactive:active {
        transform: scale(0.95);
      }

      /* V30.0 Phase 4: Analytics Card Styles */
      .analytics-card {
        background-color: #1C1C1E;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        padding: 16px;
        margin-bottom: 16px;
      }

      .analytics-section-title {
        color: #FFFFFF;
        font-size: 18px;
        font-weight: 700;
        margin-bottom: 16px;
      }

      /* V30.0: Status badges */
      .status-badge {
        display: inline-flex;
        align-items: center;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .status-optimal {
        background-color: rgba(16, 185, 129, 0.2);
        color: #10B981;
      }

      .status-monitor {
        background-color: rgba(234, 179, 8, 0.2);
        color: #EAB308;
      }

      .status-imbalance {
        background-color: rgba(239, 68, 68, 0.2);
        color: #EF4444;
      }

      /* V30.0: Progress bars for analytics */
      .progress-track {
        width: 100%;
        height: 8px;
        background-color: rgba(255, 255, 255, 0.05);
        border-radius: 4px;
        overflow: hidden;
        margin: 12px 0;
      }

      .progress-fill {
        height: 100%;
        border-radius: 4px;
        transition: width 0.3s ease;
      }

      .progress-fill-optimal {
        background-color: rgba(16, 185, 129, 0.8);
      }

      .progress-fill-monitor {
        background-color: rgba(234, 179, 8, 0.8);
      }

      .progress-fill-imbalance {
        background-color: rgba(239, 68, 68, 0.8);
      }

      /* V30.0: Insight severity cards */
      .insight-card {
        background-color: #1C1C1E;
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 12px;
        display: flex;
        gap: 12px;
      }

      .insight-card-danger {
        border-left: 4px solid #EF4444;
        background-color: rgba(239, 68, 68, 0.05);
      }

      .insight-card-warning {
        border-left: 4px solid #EAB308;
        background-color: rgba(234, 179, 8, 0.05);
      }

      .insight-card-info {
        border-left: 4px solid #3B82F6;
        background-color: rgba(59, 130, 246, 0.05);
      }

      .insight-card-success {
        border-left: 4px solid #10B981;
        background-color: rgba(16, 185, 129, 0.05);
      }

      /* V30.0: Chart container styling */
      .chart-container {
        background-color: #1C1C1E;
        border-radius: 16px;
        padding: 16px;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      #active-tab-label {
        transition: opacity 0.3s ease;
        display: inline-block;
        min-width: 120px;
      }

      .app-header {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .app-logo {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        object-fit: cover;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      }

      .volume-counter {
        display: none;
        background: linear-gradient(
          135deg,
          rgba(16, 185, 129, 0.1) 0%,
          rgba(5, 150, 105, 0.05) 100%
        );
        border: 1px solid rgba(16, 185, 129, 0.2);
        border-radius: 12px;
        padding: 12px;
        margin: 0;
        animation: slideIn 0.3s ease-out;
        position: relative;
        z-index: 10;
        backdrop-filter: blur(4px);
      }

      .volume-counter.completed-card-summary {
        display: block;
        margin: 12px 0;
      }

      .completed-card-summary {
        background: linear-gradient(
          135deg,
          rgba(16, 185, 129, 0.2) 0%,
          rgba(6, 78, 59, 0.4) 100%
        ) !important;
        border: 1px solid rgba(16, 185, 129, 0.5) !important;
        padding: 20px !important;
        animation: completePulse 0.5s ease-out !important;
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.2) !important;
        opacity: 1 !important;
        position: relative;
        z-index: 20;
      }

      @keyframes completePulse {
        0% {
          transform: scale(1);
          box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
        }
        50% {
          transform: scale(1.03);
          box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
        }
        100% {
          transform: scale(1);
          box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
        }
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .sets-container.sets-collapsed > div[id^="row_"] {
        display: none !important;
      }

      .sets-container.sets-collapsed > .grid.grid-cols-12.gap-1 {
        display: none !important;
      }

      .exercise-card.all-completed {
        opacity: 0.5;
        transition: opacity 0.3s;
        filter: grayscale(0.5);
      }

      .exercise-card.card-collapsed .exercise-header,
      .exercise-card.card-collapsed .cardio-header,
      .exercise-card.card-collapsed .exercise-footer {
        display: none !important;
      }
      
      .exercise-card.card-collapsed {
        background: transparent !important;
        border: none !important;
        box-shadow: none !important;
      }

      .exercise-card.all-completed:hover {
        opacity: 0.9;
        filter: grayscale(0);
      }

      .exercise-card.all-completed .volume-counter.completed-card-summary {
        opacity: 1 !important;
        filter: brightness(1.2);
      }

      .volume-diff-up {
        color: #10b981;
        animation: bounce 0.5s ease-out;
        font-weight: bold;
      }

      .volume-diff-down {
        color: #ef4444;
        font-weight: bold;
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-3px);
        }
      }
      .set-note-icon {
        cursor: pointer;
        transition: all 0.2s;
        color: rgba(148, 163, 184, 0.5);
      }

      .set-note-icon:hover {
        color: #fbbf24;
        transform: scale(1.2);
      }

      .set-note-icon.has-note {
        color: #fbbf24;
      }

      .set-note-popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(15, 23, 42, 0.9);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 24px;
        z-index: 1000;
        width: 90%;
        max-width: 400px;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7);
      }

      .completed-sets-summary {
        background: rgba(16, 185, 129, 0.1);
        border: 1px solid rgba(16, 185, 129, 0.2);
        border-radius: 8px;
        padding: 8px 12px;
        margin-bottom: 8px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .completed-sets-summary:hover {
        background: rgba(16, 185, 129, 0.15);
        border-color: rgba(16, 185, 129, 0.3);
      }

      .set-row-completed {
        opacity: 0.6;
        transition: opacity 0.3s;
      }

      .sets-collapsed .set-row-completed {
        display: none;
      }
    </style>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js" async defer></script>
  </head>

  <body class="flex justify-center min-h-screen bg-black">
    <!-- V30.0 Mobile Container Wrapper -->
    <div class="w-full max-w-md bg-black min-h-screen overflow-y-auto relative flex flex-col">
      <!-- Status Bar Spacer (for mobile notch/status bar) -->
      <div class="h-3 w-full shrink-0"></div>

      <header
        class="glass-panel border-b border-white/10 rounded-none border-x-0 border-t-0 p-4 pt-[calc(0.5rem+env(safe-area-inset-top))] flex justify-between items-center z-30 sticky top-0 shadow-2xl bg-black/90 backdrop-blur-md"
      >
        <div class="app-header">
          <img
            src="app-logo.png"
            onerror="this.style.display='none'"
            class="app-logo"
            alt="Logo"
          />
          <div>
            <h1 class="font-bold text-white text-sm tracking-wide">
              THE GRIND DESIGN
            </h1>
            <p
              class="text-[10px] text-app-accent uppercase tracking-wider font-bold"
            >
              V30.0 MOBILE UI
            </p>
          </div>
        </div>
        <div class="flex gap-2">
          <!-- Calendar button only (AI accessible via bottom nav) -->
          <button
            onclick="window.APP.ui.openModal('calendar')"
            class="text-gray-400 hover:text-app-accent transition p-2"
            title="Calendar"
          >
            <i class="fa-regular fa-calendar fa-lg"></i>
          </button>
        </div>
      </header>
      <main
        id="app-container"
        class="flex-1 overflow-y-auto no-scrollbar pb-24 px-4"
      >
      <div id="dashboard-view" class="fade-in space-y-6">
        <!-- V30.0: Stats Cards Container -->
        <div id="stats-cards-container">
          <!-- Stats cards (Weight + TDEE) will be injected here by renderDashboard() -->
        </div>
        <!-- V30.0 Spontaneous Mode Button with Glow Effect -->
        <section class="mb-2">
          <button
            onclick="APP.ui.openModal('spontaneous')"
            class="w-full py-4 rounded-3xl spontaneous-btn-bg flex items-center justify-center gap-3 group active:scale-[0.98] transition-transform"
          >
            <i class="fa-solid fa-person-running fa-lg text-app-accent group-hover:animate-pulse"></i>
            <span class="text-app-accent font-bold text-lg tracking-wide">Spontaneous Mode</span>
          </button>
        </section>
        <div class="flex items-center justify-between">
          <p
            class="text-xs font-bold text-slate-500 uppercase tracking-widest ml-1"
          >
            Rotasi Sesi
          </p>
          <span
            class="text-[10px] text-app-accent bg-app-accent/10 px-2 py-0.5 rounded flex items-center"
            ><i class="fa-solid fa-wand-magic-sparkles mr-1"></i>
            Auto-Suggest</span
          >
        </div>
        <div id="schedule-list" class="space-y-3 pb-10"></div>
        <!-- ADD NEW SESSION BUTTON -->
        <div class="mt-4">
          <button
            onclick="APP.session.openCreator()"
            class="w-full bg-app-accent hover:bg-app-accent/90 text-black font-bold py-4 rounded-xl shadow-lg flex items-center justify-center gap-3 active:scale-95 transition"
          >
            <i class="fa-solid fa-plus text-xl"></i>
            <span>Add New Session</span>
          </button>

          <p class="text-[10px] text-slate-500 text-center mt-2 italic">
            Buat sesi custom atau clone dari sesi existing
          </p>
        </div>
      </div>
      <div id="workout-view" class="hidden fade-in space-y-4">
        <div class="flex justify-between items-center mt-2 mb-2">
          <button
            onclick="window.APP.nav.switchView('dashboard')"
            class="flex items-center text-slate-400 hover:text-white text-sm group"
          >
            <div
              class="bg-slate-800 p-2 rounded-full mr-2 group-hover:bg-slate-700 transition"
            >
              <i class="fa-solid fa-arrow-left"></i>
            </div>
            Kembali
          </button>
          <div class="flex gap-2">
            <span
              id="spontaneous-badge"
              class="hidden text-[10px] bg-indigo-500 text-white px-2 py-1 rounded font-bold uppercase items-center shadow-lg shadow-indigo-500/30"
              ><i class="fa-solid fa-bolt mr-1"></i> SPONTANEOUS</span
            >
            <button
              onclick="APP.ui.toggleFocusMode()"
              id="focus-btn"
              class="text-xs bg-slate-800 text-slate-400 border border-slate-700 px-3 py-1.5 rounded-full hover:text-white transition flex items-center gap-2"
            >
              <i class="fa-solid fa-eye"></i> Focus Mode
            </button>
          </div>
        </div>
        <div
          id="warmup-box"
          class="bg-indigo-900/30 border border-indigo-500/30 rounded-xl p-4 mb-6 cursor-pointer active:scale-[0.98] transition"
        >
          <div
            class="flex justify-between items-center"
            onclick="APP.ui.toggleWarmup()"
          >
            <h3 class="text-indigo-400 font-bold text-sm">
              <i class="fa-solid fa-fire-flame-curved mr-2"></i> PROTOKOL
              PEMANASAN
            </h3>
            <i
              id="warmup-arrow"
              class="fa-solid fa-chevron-down text-indigo-400 text-xs transition-transform"
            ></i>
          </div>
          <div
            id="warmup-content"
            class="hidden text-sm text-slate-300 space-y-3 mt-3"
          >
            <p class="text-[10px] text-slate-500 italic mb-2">
              *Klik teks di bawah untuk mengedit
            </p>
            <div class="flex items-start gap-2">
              <i class="fa-solid fa-person-walking text-emerald-400 mt-1"></i>
              <div
                id="warmup-general"
                onclick="APP.data.editWarmup('general')"
                class="hover:text-white cursor-text"
              >
                Jalan Cepat 5 Menit.
              </div>
            </div>
            <div class="flex items-start gap-2">
              <i class="fa-solid fa-person-running text-emerald-400 mt-1"></i>
              <div
                id="warmup-dynamic"
                onclick="APP.data.editWarmup('dynamic')"
                class="hover:text-white cursor-text text-slate-400"
              >
                Arm Circles, Leg Swings
              </div>
            </div>
          </div>
        </div>
        <div
          class="bg-slate-700/50 border border-slate-700 rounded-xl p-3 mb-4 cursor-pointer"
          onclick="APP.ui.openModal('rpe')"
        >
          <p
            class="text-[10px] font-bold text-yellow-400 uppercase mb-2 flex justify-between"
          >
            <span
              ><i class="fa-solid fa-ranking-star mr-1"></i> Intensitas
              (RPE)</span
            >
            <i class="fa-solid fa-circle-info animate-pulse"></i>
          </p>
          <div
            class="grid grid-cols-5 gap-1 text-center font-mono font-bold mb-1"
          >
            <div class="text-3xl text-red-300">10</div>
            <div class="text-3xl text-orange-300">9</div>
            <div class="text-3xl text-emerald-300">8</div>
            <div class="text-3xl text-blue-300">7</div>
            <div class="text-3xl text-slate-400">6</div>
          </div>
          <div
            class="grid grid-cols-5 gap-1 text-center text-[8px] sm:text-[10px] font-bold uppercase text-slate-400"
          >
            <div>Failure</div>
            <div>Sisa 1</div>
            <div>Sisa 2</div>
            <div>Sisa 3</div>
            <div>Warm-up</div>
          </div>
        </div>
        <div id="exercise-list" class="space-y-4"></div>
        <button
          onclick="APP.data.addNewExerciseCard()"
          class="w-full glass-card border border-dashed border-slate-700 text-slate-400 py-3 rounded-xl hover:text-white hover:border-app-accent hover:bg-slate-700/50 transition mb-4"
        >
          <i class="fa-solid fa-plus mr-2"></i> Tambah Gerakan Baru
        </button>
        <div class="pt-2 pb-10">
          <button
            onclick="APP.core.finishSession()"
            class="w-full glass-btn border-2 border-app-accent/50 text-app-accent font-bold py-4 rounded-xl shadow-lg flex items-center justify-center gap-2 active:scale-95 transition hover:bg-app-accent/10"
          >
            <i class="fa-solid fa-flag-checkered"></i> SELESAI & SIMPAN LOG
          </button>
        </div>
      </div>

      <!-- ========================================== -->
      <!-- V30.0 Phase 3.5: KLINIK (Analytics) VIEW   -->
      <!-- Converted from modal to view navigation   -->
      <!-- ========================================== -->
      <div id="klinik-view" class="hidden fade-in">
        <div class="space-y-4">
          <!-- Header -->
          <div class="flex justify-between items-center mt-2 mb-2 border-b border-white/10 pb-3">
            <h3 class="font-bold text-white text-xl">Clinical Analytics</h3>
          </div>

          <!-- Exercise Selector -->
          <div id="klinik-exercise-selector" class="mb-4">
            <select
              id="klinik-stats-select"
              onchange="APP.stats.updateChart()"
              class="w-full glass-input text-white text-sm p-3 rounded-xl border border-white/10"
            ></select>
          </div>

          <!-- Tab Navigation -->
          <div class="mb-3">
            <div class="flex gap-2 justify-center mb-2">
              <button
                id="klinik-tab-dashboard"
                onclick="APP.stats.switchTab('dashboard')"
                class="tab-btn active w-12 h-12 flex items-center justify-center text-xl rounded-lg transition-all"
              >
                üìä
              </button>
              <button
                id="klinik-tab-chart"
                onclick="APP.stats.switchTab('chart')"
                class="tab-btn inactive w-12 h-12 flex items-center justify-center text-xl rounded-lg transition-all"
              >
                üìà
              </button>
              <button
                id="klinik-tab-table"
                onclick="APP.stats.switchTab('table')"
                class="tab-btn inactive w-12 h-12 flex items-center justify-center text-xl rounded-lg transition-all"
              >
                üìã
              </button>
              <button
                id="klinik-tab-bodyparts"
                onclick="APP.stats.switchTab('bodyparts')"
                class="tab-btn inactive w-12 h-12 flex items-center justify-center text-xl rounded-lg transition-all"
              >
                üí™
              </button>
              <button
                id="klinik-tab-advanced"
                onclick="APP.stats.switchTab('advanced')"
                class="tab-btn inactive w-12 h-12 flex items-center justify-center text-xl rounded-lg transition-all"
              >
                üî¨
              </button>
            </div>
            <div class="text-center">
              <span
                id="klinik-active-tab-label"
                class="text-xs font-bold text-emerald-400 uppercase tracking-wider"
              >
                Dashboard
              </span>
            </div>
          </div>

          <!-- Dashboard Tab Content -->
          <div
            id="klinik-dashboard-content"
            class="glass-panel p-4 rounded-xl border border-white/10 min-h-[350px] overflow-y-auto no-scrollbar mb-4"
          >
            <div class="mb-6">
              <h3 class="text-xs text-slate-400 uppercase font-bold mb-3 flex items-center gap-2">
                <i class="fa-solid fa-calendar-week"></i> This Week vs Last Week
              </h3>
              <div class="grid grid-cols-2 gap-3">
                <div class="glass-card p-3 rounded-lg border border-white/5">
                  <div class="text-[10px] text-slate-400 mb-1">Total Volume</div>
                  <div class="flex items-baseline gap-2">
                    <span id="klinik-dash-volume-current" class="text-2xl font-bold text-white">0</span>
                    <span class="text-xs text-slate-500">kg</span>
                  </div>
                  <div id="klinik-dash-volume-diff" class="text-xs font-bold mt-1">
                    <span class="text-slate-400">No data</span>
                  </div>
                </div>
                <div class="glass-card p-3 rounded-lg border border-white/5">
                  <div class="text-[10px] text-slate-400 mb-1">Avg RPE</div>
                  <div class="flex items-baseline gap-2">
                    <span id="klinik-dash-rpe-current" class="text-2xl font-bold text-white">0</span>
                  </div>
                  <div id="klinik-dash-rpe-diff" class="text-xs font-bold mt-1">
                    <span class="text-slate-400">No data</span>
                  </div>
                </div>
                <div class="glass-card p-3 rounded-lg border border-white/5">
                  <div class="text-[10px] text-slate-400 mb-1">Sessions</div>
                  <div class="flex items-baseline gap-2">
                    <span id="klinik-dash-sessions-current" class="text-2xl font-bold text-white">0</span>
                  </div>
                  <div id="klinik-dash-sessions-diff" class="text-xs font-bold mt-1">
                    <span class="text-slate-400">No data</span>
                  </div>
                </div>
                <div class="glass-card p-3 rounded-lg border border-white/5">
                  <div class="text-[10px] text-slate-400 mb-1">Tonnage</div>
                  <div class="flex items-baseline gap-2">
                    <span id="klinik-dash-tonnage-current" class="text-2xl font-bold text-white">0</span>
                    <span class="text-xs text-slate-500">kg</span>
                  </div>
                  <div id="klinik-dash-tonnage-diff" class="text-xs font-bold mt-1">
                    <span class="text-slate-400">No data</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="mb-6">
              <h3 class="text-xs text-slate-400 uppercase font-bold mb-3 flex items-center gap-2">
                <i class="fa-solid fa-trophy"></i> Top Gainers (Volume %)
              </h3>
              <div id="klinik-dash-top-gainers" class="space-y-2">
                <p class="text-xs text-slate-500 italic">Complete more sessions to see gainers.</p>
              </div>
            </div>
            <div id="klinik-dash-fatigue-alert" class="hidden">
              <div class="bg-red-900/20 border border-red-900/50 rounded-lg p-3">
                <div class="flex items-start gap-2">
                  <i class="fa-solid fa-triangle-exclamation text-red-400 mt-0.5"></i>
                  <div>
                    <div class="text-xs font-bold text-red-400 mb-1">Fatigue Alert</div>
                    <div id="klinik-dash-fatigue-message" class="text-xs text-slate-300">High RPE detected. Consider rest.</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Chart Tab Content -->
          <div
            id="klinik-chart-content"
            class="glass-panel p-2 rounded-xl border border-white/10 min-h-[250px] relative mb-4 hidden"
          >
            <canvas id="klinik-progressChart"></canvas>
            <div id="klinik-no-data-msg" class="absolute inset-0 flex items-center justify-center text-slate-500 text-xs hidden">
              No Data.
            </div>
          </div>

          <!-- Table Tab Content -->
          <div
            id="klinik-table-content"
            class="glass-panel p-2 rounded-xl border border-white/10 min-h-[250px] relative mb-4 hidden overflow-y-auto no-scrollbar"
          >
            <table class="hist-table">
              <thead>
                <tr>
                  <th>TGL</th>
                  <th>BEBAN</th>
                  <th>REPS</th>
                  <th>RPE</th>
                  <th>VOL</th>
                </tr>
              </thead>
              <tbody id="klinik-hist-table-body"></tbody>
            </table>
          </div>

          <!-- Bodyparts Tab Content -->
          <div
            id="klinik-bodyparts-content"
            class="glass-panel p-4 rounded-xl border border-white/10 min-h-[350px] overflow-y-auto no-scrollbar mb-4 hidden"
          >
            <div class="mb-4">
              <div class="flex gap-2 justify-center">
                <button
                  id="klinik-view-combined-btn"
                  onclick="APP.stats.setBodyPartView('combined')"
                  class="px-4 py-2 text-xs font-bold rounded-lg transition-all duration-300 bg-emerald-600 text-white"
                >
                  üìä Combined View
                </button>
                <button
                  id="klinik-view-split-btn"
                  onclick="APP.stats.setBodyPartView('split')"
                  class="px-4 py-2 text-xs font-bold rounded-lg transition-all duration-300 bg-slate-700 text-slate-400"
                >
                  üîÄ Split View (Upper/Lower)
                </button>
              </div>
              <p class="text-[9px] text-slate-500 text-center mt-2 italic">
                Combined: All muscles vs Legs baseline | Split: Fair comparison per region
              </p>
            </div>
            <select
              id="klinik-bodypart-period"
              onchange="APP.stats.updateBodyParts()"
              class="w-full glass-input text-white text-xs p-2 rounded border border-white/10 mb-4"
            >
              <option value="4">Last 4 Weeks</option>
              <option value="8">Last 8 Weeks</option>
              <option value="12">Last 12 Weeks</option>
            </select>
            <div class="mb-6">
              <h3 class="text-xs text-slate-400 uppercase font-bold mb-3">Volume by Muscle Group</h3>
              <div id="klinik-bodypart-bars" class="space-y-3">
                <p class="text-xs text-slate-500 italic">Loading...</p>
              </div>
            </div>
            <div id="klinik-bodypart-imbalance" class="hidden">
              <div class="bg-yellow-900/20 border border-yellow-900/50 rounded-lg p-3">
                <div class="flex items-start gap-2">
                  <i class="fa-solid fa-scale-unbalanced text-yellow-400 mt-0.5"></i>
                  <div>
                    <div class="text-xs font-bold text-yellow-400 mb-1">Imbalance Detected</div>
                    <div id="klinik-bodypart-imbalance-message" class="text-xs text-slate-300">Checking balance...</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- V30.3: Advanced Analytics Tab Content -->
          <div
            id="klinik-advanced-content"
            class="glass-panel p-4 rounded-xl border border-white/10 min-h-[350px] overflow-y-auto no-scrollbar mb-4 hidden"
          >
            <div class="mb-4">
              <h3 class="text-xs text-slate-400 uppercase font-bold mb-3 flex items-center gap-2">
                <i class="fa-solid fa-chart-line"></i> Advanced Analytics
                <span class="text-[9px] font-normal text-slate-500">(V30.3)</span>
              </h3>
              <p class="text-[10px] text-slate-400 italic mb-4">
                Evidence-based metrics, balance ratios, and clinical insights derived from your training data.
              </p>
            </div>

            <!-- Core Metrics Section -->
            <div class="mb-6">
              <h4 class="text-xs text-slate-300 font-bold mb-3 flex items-center gap-2">
                üí™ Core Training Metrics
              </h4>
              <div id="klinik-advanced-core-metrics" class="space-y-3">
                <!-- Core Training and Stability cards will be rendered here -->
              </div>
            </div>

            <!-- Balance Ratios Section -->
            <div class="mb-6">
              <h4 class="text-xs text-slate-300 font-bold mb-3 flex items-center gap-2">
                ‚öñÔ∏è Balance Ratios
              </h4>
              <div id="klinik-advanced-ratios" class="space-y-3">
                <!-- Push/Pull and Quad/Hams cards will be rendered here -->
              </div>
            </div>

            <!-- Training Analysis Section (V30.4) -->
            <div class="mb-6">
              <h4 class="text-xs text-slate-300 font-bold mb-3 flex items-center gap-2">
                üìä Training Analysis
                <span class="text-[9px] font-normal text-slate-500">(Evidence-Based)</span>
              </h4>
              <div id="klinik-training-analysis" class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <!-- Training analysis cards will be rendered here -->
              </div>
            </div>

            <!-- Clinical Insights Section -->
            <div class="mb-6">
              <h4 class="text-xs text-slate-300 font-bold mb-3 flex items-center gap-2">
                <i class="fa-solid fa-lightbulb"></i> Clinical Insights
                <span class="text-[9px] font-normal text-slate-500">(Evidence-Based)</span>
              </h4>
              <div id="klinik-advanced-insights" class="space-y-2">
                <!-- Clinical insight cards will be rendered here -->
              </div>
            </div>
          </div>

          <!-- Vital Signs (Legacy) -->
          <div id="klinik-vital-signs" class="grid grid-cols-3 gap-2 text-center hidden">
            <div class="glass-card p-2 rounded border border-white/5">
              <div class="text-[10px] text-slate-400 uppercase">PR</div>
              <div class="text-lg font-bold text-emerald-400" id="klinik-stat-pr">--</div>
            </div>
            <div class="glass-card p-2 rounded border border-white/5">
              <div class="text-[10px] text-slate-400 uppercase">Vol Avg</div>
              <div class="text-lg font-bold text-blue-400" id="klinik-stat-vol">--</div>
            </div>
            <div class="glass-card p-2 rounded border border-white/5">
              <div class="text-[10px] text-slate-400 uppercase">Count</div>
              <div class="text-lg font-bold text-white" id="klinik-stat-count">--</div>
            </div>
          </div>
        </div>
      </div>

      <!-- ========================================== -->
      <!-- V30.0 Phase 3.5: AI VIEW                   -->
      <!-- Converted from modal to view navigation   -->
      <!-- ========================================== -->
      <div id="ai-view" class="hidden fade-in">
        <div class="space-y-4">
          <!-- Header -->
          <div class="flex justify-between items-center mt-2 mb-2 pb-3 border-b border-slate-700">
            <h3 class="font-bold text-white text-xl">
              <i class="fa-solid fa-microchip text-purple-400 mr-2"></i>AI Command Center
            </h3>
          </div>

          <!-- Mode Selector -->
          <div class="mb-4">
            <label class="text-xs text-slate-400 font-bold uppercase block mb-2">Mode</label>
            <select
              id="ai-view-mode-selector"
              onchange="APP.ui.switchAIMode(this.value)"
              class="w-full glass-input border border-white/10 text-white text-sm p-3 rounded-lg focus:border-purple-500 transition"
            >
              <option value="context">üì§ Ambil Konteks (Export)</option>
              <option value="import">üì• Import Resep (JSON)</option>
              <option value="library">üìö Resep Tersimpan</option>
              <option value="backup">üíæ Backup & Restore</option>
              <option value="prompt-manager">üéØ Kelola Prompt AI</option>
            </select>
          </div>

          <!-- Dynamic Content Area -->
          <div id="ai-view-content-area" class="overflow-y-auto no-scrollbar min-h-[400px]">
            <!-- Content injected by switchAIMode() -->
          </div>
        </div>
      </div>

      <!-- ========================================== -->
      <!-- V30.0 Phase 3.5: SETTINGS VIEW             -->
      <!-- Converted from modal to view navigation   -->
      <!-- ========================================== -->
      <div id="settings-view" class="hidden fade-in">
        <div class="space-y-4">
          <!-- Header -->
          <div class="flex justify-between items-center mt-2 mb-2 pb-3 border-b border-white/10">
            <h3 class="font-bold text-white text-xl">Profile & Settings</h3>
          </div>

          <!-- Profile Form -->
          <div class="space-y-3">
            <div class="grid grid-cols-2 gap-3">
              <div>
                <span class="text-[10px] text-slate-400">Nama</span>
                <input
                  type="text"
                  id="settings-prof-name"
                  class="w-full p-2 glass-input rounded text-white text-sm"
                  placeholder="Masukkan nama..."
                />
              </div>
              <div>
                <span class="text-[10px] text-slate-400">Tinggi (cm)</span>
                <input
                  type="number"
                  id="settings-prof-height"
                  class="w-full p-2 glass-input rounded text-white text-sm"
                  placeholder="170"
                />
              </div>
            </div>
            <div class="grid grid-cols-2 gap-3">
              <div>
                <span class="text-[10px] text-slate-400">Usia</span>
                <input
                  type="number"
                  id="settings-prof-age"
                  class="w-full p-2 glass-input rounded text-white text-sm"
                  placeholder="25"
                />
              </div>
              <div>
                <span class="text-[10px] text-slate-400">Gender</span>
                <select
                  id="settings-prof-gender"
                  class="w-full p-2 glass-input rounded text-white text-sm"
                >
                  <option value="male">Pria</option>
                  <option value="female">Wanita</option>
                </select>
              </div>
            </div>
            <div>
              <span class="text-[10px] text-slate-400">Aktivitas</span>
              <select
                id="settings-prof-active"
                class="w-full p-2 glass-input rounded text-white text-sm"
              >
                <option value="1.2">Sedentary (Tidak ada olahraga)</option>
                <option value="1.375">Light (1-3 hari/minggu)</option>
                <option value="1.55">Moderate (3-5 hari/minggu)</option>
                <option value="1.725">Active (6-7 hari/minggu)</option>
              </select>
            </div>
            <button
              onclick="APP.data.saveProfileFromSettings()"
              class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-lg transition active:scale-95"
            >
              Simpan Profil
            </button>
          </div>

          <!-- Storage Status -->
          <div class="glass-panel p-4 rounded-xl border border-white/10">
            <h4 class="text-xs font-bold text-slate-400 mb-2 uppercase flex justify-between">
              <span><i class="fa-solid fa-database mr-1"></i> Storage Status</span>
              <button onclick="APP.showStorageStats()" class="text-blue-400 hover:text-blue-300">
                <i class="fa-solid fa-rotate"></i>
              </button>
            </h4>
            <div id="settings-storage-stats" class="grid grid-cols-2 gap-2 text-xs">
              <div class="glass-card p-2 rounded">
                <div class="text-slate-500 text-[10px]">Items</div>
                <div class="text-white font-bold" id="settings-stat-items">--</div>
              </div>
              <div class="glass-card p-2 rounded">
                <div class="text-slate-500 text-[10px]">Size</div>
                <div class="text-white font-bold" id="settings-stat-size">--</div>
              </div>
              <div class="glass-card p-2 rounded col-span-2">
                <div class="text-slate-500 text-[10px]">Usage</div>
                <div class="flex items-center gap-2">
                  <div class="flex-1 bg-white/10 rounded-full h-2 overflow-hidden">
                    <div id="settings-usage-bar" class="bg-emerald-500 h-full transition-all" style="width: 0%"></div>
                  </div>
                  <span class="text-white font-bold text-[10px]" id="settings-stat-usage">0%</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Cloud Sync -->
          <div class="p-4 rounded-xl border border-teal-500/40 bg-teal-900/20">
            <div class="mb-4 p-4 bg-indigo-900/30 rounded-2xl border border-indigo-500/30 shadow-inner">
              <h3 class="text-[10px] font-bold text-indigo-400 mb-3 uppercase tracking-widest flex items-center">
                <i class="fa-solid fa-cloud mr-2"></i> Cloud Sync (G-Drive)
              </h3>
              <div class="grid grid-cols-2 gap-2">
                <button
                  onclick="syncToCloud()"
                  class="bg-indigo-600 hover:bg-indigo-500 text-white py-3 rounded-xl font-bold text-xs transition active:scale-95 flex flex-col items-center gap-1"
                >
                  <i class="fa-solid fa-cloud-arrow-up text-base"></i> Backup
                </button>
                <button
                  onclick="restoreFromCloud()"
                  class="bg-slate-700 hover:bg-slate-600 text-white py-3 rounded-xl font-bold text-xs transition active:scale-95 flex flex-col items-center gap-1"
                >
                  <i class="fa-solid fa-cloud-arrow-down text-base"></i> Restore
                </button>
              </div>
              <p class="text-[9px] text-slate-500 mt-2 text-center italic leading-tight">
                Backup disimpan aman di AppData Google Drive.
              </p>
            </div>
            <div class="border-t border-slate-700 pt-3 mt-2">
              <div class="grid grid-cols-2 gap-4">
                <button
                  onclick="APP.data.exportData()"
                  class="bg-slate-700 text-emerald-400 text-xs py-2 rounded"
                >
                  Backup Manual
                </button>
                <label class="bg-slate-700 text-blue-400 text-xs py-2 rounded text-center cursor-pointer">
                  Restore Manual
                  <input type="file" id="settings-import-file" class="hidden" onchange="APP.data.importData(this)" />
                </label>
              </div>
            </div>
          </div>

          <!-- Danger Zone -->
          <div class="p-4 rounded-xl border border-red-900/30 bg-red-950/20">
            <h4 class="text-red-400 font-bold text-[10px] mb-2 uppercase tracking-wide">
              <i class="fa-solid fa-triangle-exclamation mr-1"></i> Data Danger Zone
            </h4>
            <div class="grid grid-cols-1 gap-2">
              <button
                onclick="APP.data.deleteLogs('today')"
                class="w-full bg-slate-700 text-slate-300 text-xs py-2 rounded hover:bg-red-900/50 hover:text-red-400 transition text-left px-3 flex justify-between items-center"
              >
                <span>Hapus Log Hari Ini</span> <i class="fa-solid fa-trash"></i>
              </button>
              <div class="flex gap-2">
                <input
                  type="date"
                  id="settings-del-date-picker"
                  class="glass-input text-white text-xs p-2 rounded border border-white/10 flex-1"
                />
                <button
                  onclick="APP.data.deleteLogs('date')"
                  class="bg-slate-700 text-slate-300 text-xs px-3 rounded hover:bg-red-900/50 hover:text-red-400 transition whitespace-nowrap"
                >
                  Hapus Tgl Ini
                </button>
              </div>
              <button
                onclick="APP.data.deleteLogs('all')"
                class="w-full bg-red-900/30 border border-red-900/50 text-red-400 font-bold text-xs py-3 rounded mt-2 hover:bg-red-900 hover:text-white transition flex items-center justify-center gap-2 shadow-lg shadow-red-900/10"
              >
                <i class="fa-solid fa-radiation"></i> RESET TOTAL (FRESH START)
              </button>
            </div>
          </div>
        </div>
      </div>

    </main>

    <!-- V30.0: Bottom Navigation (Phase 3.5: All views use switchView) -->
    <nav id="bottom-nav" class="fixed bottom-0 left-0 right-0 mx-auto w-full max-w-md bg-black/90 backdrop-blur-md border-t border-white/5 pb-6 pt-2 px-6 z-50">
      <ul class="flex justify-between items-center">

        <!-- Home Tab -->
        <li class="flex-1">
          <a class="flex flex-col items-center gap-1 nav-item text-app-accent nav-item-active"
             data-view="dashboard"
             href="#"
             onclick="window.APP.nav.switchView('dashboard'); return false;">
            <i class="fa-solid fa-house text-xl"></i>
            <span class="text-[10px] font-medium">Home</span>
          </a>
        </li>

        <!-- Analytics Tab (V30.0 Phase 3.5: Now uses switchView) -->
        <li class="flex-1">
          <a class="flex flex-col items-center gap-1 nav-item text-gray-500"
             data-view="klinik"
             href="#"
             onclick="window.APP.nav.switchView('klinik'); return false;">
            <i class="fa-solid fa-chart-simple text-xl"></i>
            <span class="text-[10px] font-medium">Analytics</span>
          </a>
        </li>

        <!-- AI Tab (V30.0 Phase 3.5: Now uses switchView) -->
        <li class="flex-1">
          <a class="flex flex-col items-center gap-1 nav-item text-gray-500"
             data-view="ai"
             href="#"
             onclick="window.APP.nav.switchView('ai'); return false;">
            <i class="fa-solid fa-brain text-xl"></i>
            <span class="text-[10px] font-medium">AI</span>
          </a>
        </li>

        <!-- Profile Tab (V30.0 Phase 3.5: Now uses switchView) -->
        <li class="flex-1">
          <a class="flex flex-col items-center gap-1 nav-item text-gray-500"
             data-view="settings"
             href="#"
             onclick="window.APP.nav.switchView('settings'); return false;">
            <i class="fa-regular fa-user text-xl"></i>
            <span class="text-[10px] font-medium">Profile</span>
          </a>
        </li>

      </ul>
    </nav>

    </div><!-- END: V30.0 Mobile Container Wrapper -->

    <div id="toast-container"></div>

    <!-- DEEP SESSION EDITOR MODAL -->
    <div
      id="session-editor-modal"
      class="fixed inset-0 bg-black/95 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm"
    >
      <div
        class="glass-panel w-[95%] max-w-2xl rounded-2xl border border-white/10 p-5 flex flex-col fade-in max-h-[90vh] overflow-y-auto"
      >
        <div
          class="flex justify-between items-center mb-4 pb-3 border-b border-white/10"
        >
          <h3 class="font-bold text-white text-lg">
            <i class="fa-solid fa-pen-to-square text-app-accent mr-2"></i>
            Edit Sesi Lengkap
          </h3>
          <button
            onclick="APP.ui.closeModal('session-editor')"
            class="text-slate-400 hover:text-white"
          >
            <i class="fa-solid fa-xmark fa-lg"></i>
          </button>
        </div>

        <div class="overflow-y-auto no-scrollbar flex-1 space-y-4">
          <!-- Session Metadata -->
          <div class="glass-card p-4 rounded-xl border border-white/10">
            <h4
              class="text-xs font-bold text-slate-400 uppercase mb-3 flex items-center"
            >
              <i class="fa-solid fa-tag mr-2"></i>Session Metadata
            </h4>

            <div class="grid grid-cols-2 gap-3 mb-3">
              <div>
                <label class="text-[10px] text-slate-500 block mb-1"
                  >Label Tag</label
                >
                  <input
                  type="text"
                  id="edit-session-label"
                  class="w-full glass-input border border-white/10 text-white text-sm p-2 rounded focus:border-emerald-500"
                  placeholder="UPPER A"
                />
              </div>
              <div>
                <label class="text-[10px] text-slate-500 block mb-1"
                  >Session Name</label
                >
                  <input
                  type="text"
                  id="edit-session-title"
                  class="w-full glass-input border border-white/10 text-white text-sm p-2 rounded focus:border-emerald-500"
                  placeholder="Upper Body Strength"
                />
              </div>
            </div>

            <div>
              <label class="text-[10px] text-slate-500 block mb-1"
                >Warmup Protocol</label
              >
              <textarea
                id="edit-session-warmup"
                rows="2"
                class="w-full glass-input border border-white/10 text-white text-xs p-2 rounded focus:border-emerald-500"
                placeholder="Arm Circles, Band Pull-Aparts, Light Cardio"
              ></textarea>
            </div>

            <!-- Session Management -->
            <div class="mt-4 pt-3 border-t border-white/10">
              <p class="text-[10px] text-slate-500 font-bold uppercase mb-3">
                <i class="fa-solid fa-gears mr-1"></i> Session Management
              </p>
              
              <div class="space-y-3">
                <!-- Rotation -->
                <div class="flex justify-between items-center bg-white/5 p-3 rounded-xl border border-white/5">
                  <div>
                    <p class="text-[10px] text-slate-400 font-bold uppercase">Rotation Status</p>
                    <p id="rotation-status" class="text-xs text-slate-300 mt-0.5">
                      Last: <span class="text-emerald-400">Never</span>
                    </p>
                  </div>
                  <button
                    onclick="APP.session.resetRotation()"
                    class="text-[10px] bg-blue-600/20 hover:bg-blue-600/40 text-blue-400 px-3 py-2 rounded-lg font-bold transition border border-blue-500/30"
                  >
                    <i class="fa-solid fa-rotate-left mr-1"></i>Reset
                  </button>
                </div>
                
                <!-- Reorder & Delete -->
                <div class="grid grid-cols-3 gap-2">
                  <button
                    onclick="APP.session.reorder(APP.state.currentEditingSessionId, -1)"
                    class="bg-white/5 hover:bg-white/10 text-slate-300 py-3 rounded-xl border border-white/10 transition flex flex-col items-center justify-center gap-1 active:scale-95"
                  >
                    <i class="fa-solid fa-arrow-up text-xs"></i>
                    <span class="text-[10px] font-bold">MOVE UP</span>
                  </button>
                  <button
                    onclick="APP.session.reorder(APP.state.currentEditingSessionId, 1)"
                    class="bg-white/5 hover:bg-white/10 text-slate-300 py-3 rounded-xl border border-white/10 transition flex flex-col items-center justify-center gap-1 active:scale-95"
                  >
                    <i class="fa-solid fa-arrow-down text-xs"></i>
                    <span class="text-[10px] font-bold">MOVE DOWN</span>
                  </button>
                  <button
                    onclick="APP.session.confirmDelete(event, APP.state.currentEditingSessionId)"
                    class="bg-red-500/10 hover:bg-red-500/20 text-red-500 py-3 rounded-xl border border-red-500/20 transition flex flex-col items-center justify-center gap-1 active:scale-95"
                  >
                    <i class="fa-solid fa-trash-can text-xs"></i>
                    <span class="text-[10px] font-bold">DELETE</span>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Live Volume Preview -->
          <div
            id="live-volume-preview"
            class="bg-gradient-to-br from-indigo-900/30 to-slate-900/50 p-4 rounded-xl border border-indigo-500/30"
          >
            <h4
              class="text-xs font-bold text-indigo-300 uppercase mb-3 flex items-center"
            >
              <i class="fa-solid fa-chart-bar mr-2"></i>Live Volume Distribution
            </h4>
            <div id="volume-bars-container" class="space-y-2">
              <!-- Dynamically populated -->
            </div>
          </div>

          <!-- Exercise List -->
          <div class="glass-card p-4 rounded-xl border border-white/10">
            <div class="flex justify-between items-center mb-3">
              <h4
                class="text-xs font-bold text-slate-400 uppercase flex items-center"
              >
                <i class="fa-solid fa-dumbbell mr-2"></i>Exercises
                <span
                  id="exercise-count-badge"
                  class="ml-2 text-[10px] bg-emerald-600 text-white px-2 py-0.5 rounded"
                  >0</span
                >
              </h4>
              <button
                onclick="APP.session.addExerciseToSession()"
                class="text-xs bg-emerald-600 hover:bg-emerald-500 text-white px-3 py-2 rounded-lg font-bold transition flex items-center gap-1"
              >
                <i class="fa-solid fa-plus"></i> Add Exercise
              </button>
            </div>

            <div
              id="editor-exercise-list"
              class="space-y-2 max-h-[300px] overflow-y-auto no-scrollbar"
            >
              <!-- Dynamically populated -->
            </div>
          </div>
        </div>

        <!-- Footer Actions -->
        <div class="flex gap-2 mt-4 pt-4 border-t border-white/10">
          <button
            onclick="APP.session.saveSessionEdits()"
            class="flex-1 bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-3 rounded-xl transition active:scale-95 flex items-center justify-center gap-2"
          >
            <i class="fa-solid fa-floppy-disk"></i>
            SAVE CHANGES
          </button>
          <button
            onclick="APP.ui.closeModal('session-editor')"
            class="px-6 bg-slate-700 hover:bg-slate-600 text-white font-bold py-3 rounded-xl transition"
          >
            Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- SESSION CREATOR MODAL -->
    <div
      id="session-creator-modal"
      class="fixed inset-0 bg-black/95 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm"
    >
      <div
        class="glass-panel w-[95%] max-w-md rounded-2xl border border-white/10 p-5 flex flex-col fade-in max-h-[90vh] overflow-y-auto"
      >
        <div
          class="flex justify-between items-center mb-4 pb-2 border-b border-white/10"
        >
          <h3 class="font-bold text-white">
            <i class="fa-solid fa-plus-circle text-emerald-400 mr-2"></i>Buat
            Sesi Baru
          </h3>
          <button
            onclick="APP.ui.closeModal('session-creator')"
            class="text-slate-400 hover:text-white"
          >
            <i class="fa-solid fa-xmark fa-lg"></i>
          </button>
        </div>

        <div class="space-y-4">
          <!-- Session Name -->
          <div>
            <label
              class="text-xs text-slate-400 font-bold uppercase block mb-2"
            >
              Nama Sesi
            </label>
            <input
              type="text"
              id="new-session-name"
              placeholder="contoh: Upper Body A"
              class="w-full glass-input border border-white/10 text-white text-sm p-3 rounded-lg focus:border-emerald-500"
            />
          </div>

          <!-- Session Label -->
          <div>
            <label
              class="text-xs text-slate-400 font-bold uppercase block mb-2"
            >
              Label Tag
            </label>
            <input
              type="text"
              id="new-session-label"
              placeholder="contoh: UPPER A"
              class="w-full glass-input border border-white/10 text-white text-sm p-3 rounded-lg focus:border-emerald-500"
            />
          </div>

          <!-- Warmup Protocol -->
          <div>
            <label
              class="text-xs text-slate-400 font-bold uppercase block mb-2"
            >
              Warmup Protocol
            </label>
            <textarea
              id="new-session-warmup"
              placeholder="contoh: Arm Circles, Band Pull-Aparts"
              rows="2"
              class="w-full glass-input border border-white/10 text-white text-sm p-3 rounded-lg focus:border-emerald-500"
            ></textarea>
          </div>

          <!-- Create Options -->
          <div class="border-t border-white/10 pt-4">
            <p class="text-xs text-slate-400 mb-3 font-bold uppercase">
              Pilih Metode
            </p>

            <div class="grid grid-cols-1 gap-2">
              <button
                onclick="APP.session.createEmpty()"
                class="bg-slate-700 hover:bg-slate-600 text-white text-sm font-bold py-3 px-4 rounded-lg flex items-center gap-3 transition active:scale-95"
              >
                <i class="fa-solid fa-file text-emerald-400"></i>
                <div class="text-left">
                  <div>Buat Kosong</div>
                  <div class="text-[10px] text-slate-400 font-normal">
                    Mulai dari nol, tambah exercise manual
                  </div>
                </div>
              </button>

              <button
                onclick="APP.session.showCloneOptions()"
                class="bg-slate-700 hover:bg-slate-600 text-white text-sm font-bold py-3 px-4 rounded-lg flex items-center gap-3 transition active:scale-95"
              >
                <i class="fa-solid fa-clone text-blue-400"></i>
                <div class="text-left">
                  <div>Clone dari Sesi Lain</div>
                  <div class="text-[10px] text-slate-400 font-normal">
                    Salin struktur sesi existing
                  </div>
                </div>
              </button>
            </div>

            <!-- Clone Options (Hidden by default) -->
            <div id="clone-options" class="hidden mt-3">
              <label
                class="text-xs text-slate-400 font-bold uppercase block mb-2"
              >
                Pilih Sesi untuk di-Clone
              </label>
              <select
                id="clone-source-select"
                class="w-full glass-input border border-white/10 text-white text-sm p-3 rounded-lg"
              >
                <option value="">-- Pilih Sesi --</option>
              </select>
              <button
                onclick="APP.session.createClone()"
                class="w-full mt-2 bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 rounded-lg transition"
              >
                Clone Sekarang
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div
      id="spontaneous-modal"
      class="fixed inset-0 bg-black/95 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm"
    >
      <div
        class="glass-panel w-[95%] max-w-md rounded-2xl border border-white/10 p-5 flex flex-col fade-in max-h-[90vh] overflow-y-auto"
      >
        <div
          class="flex justify-between items-center mb-4 pb-2 border-b border-white/10"
        >
          <h3 class="font-bold text-white">
            <i class="fa-solid fa-bolt text-indigo-400 mr-2"></i>Spontaneous
            Session
          </h3>
          <button
            onclick="APP.ui.closeModal('spontaneous')"
            class="text-slate-400 hover:text-white"
          >
            <i class="fa-solid fa-xmark fa-lg"></i>
          </button>
        </div>
        <div class="overflow-y-auto no-scrollbar space-y-4">
          <div class="glass-card p-4 rounded-xl border border-white/10">
            <p class="text-xs text-slate-400 mb-2 font-bold uppercase">
              Manual Start
            </p>
            <button
              onclick="APP.session.spontaneous.startEmpty()"
              class="w-full bg-slate-700 hover:bg-slate-600 text-white text-xs font-bold py-3 rounded-lg flex items-center justify-center gap-2 transition active:scale-95"
            >
              <i class="fa-solid fa-plus"></i> Buat Sesi Kosong (Express)
            </button>
          </div>
          <div
            class="glass-card p-4 rounded-xl border border-white/10"
          >
            <div class="flex items-center justify-between mb-2">
              <p class="text-xs text-indigo-300 font-bold uppercase">
                Blueprints (Presets)
              </p>
              <button
                onclick="APP.ui.openAICommandCenter('library')"
                class="text-xs text-indigo-400 hover:text-indigo-300 transition"
                title="Kelola di AI Command Center"
              >
                <i class="fa-solid fa-cog"></i>
              </button>
            </div>
            <div id="blueprint-list" class="space-y-2"></div>
            <p class="text-[10px] text-slate-500 italic text-center mt-3">
              Klik <i class="fa-solid fa-cog"></i> untuk manage atau import preset
            </p>
          </div>
        </div>
      </div>
    </div>
    <div
      id="error-modal"
      class="fixed inset-0 bg-red-900/90 z-[999] hidden flex items-center justify-center p-4 backdrop-blur-md"
    >
      <div
        class="bg-slate-900 w-full max-w-md rounded-2xl border-2 border-red-500 p-5 shadow-2xl"
      >
        <div
          class="flex items-center gap-3 mb-4 text-red-500 border-b border-red-500/30 pb-3"
        >
          <i class="fa-solid fa-bug text-2xl animate-pulse"></i>
          <h3 class="font-bold text-lg">System Crash Diagnosis</h3>
        </div>
        <p class="text-xs text-slate-300 mb-2">
          Terjadi kesalahan sistem. Silakan salin log di bawah dan kirim ke
          Gemini untuk perbaikan instan.
        </p>
        <textarea
          id="error-log-text"
          class="w-full bg-slate-950 text-red-300 font-mono text-[10px] p-3 rounded-lg border border-red-900 h-32 focus:border-red-500 mb-3"
          readonly
        ></textarea>
        <div class="grid grid-cols-2 gap-2">
          <button
            onclick="APP.debug.copyErrorLog()"
            class="bg-red-600 hover:bg-red-500 text-white font-bold py-3 rounded-lg flex items-center justify-center gap-2 transition active:scale-95"
          >
            <i class="fa-regular fa-copy"></i> Salin Log</button
          ><button
            onclick="location.reload()"
            class="bg-slate-700 hover:bg-slate-600 text-white font-bold py-3 rounded-lg flex items-center justify-center gap-2 transition active:scale-95"
          >
            <i class="fa-solid fa-rotate-right"></i> Refresh App
          </button>
        </div>
      </div>
    </div>
    <div
      id="rpe-modal"
      class="fixed inset-0 bg-black/95 z-[60] hidden flex items-center justify-center p-4 backdrop-blur-sm"
    >
      <div
        class="glass-panel w-full max-w-md rounded-2xl border border-white/10 p-5 fade-in max-h-[90vh] overflow-y-auto"
      >
        <!-- V30.7: Dynamic RPE content based on exercise type -->
        <div id="rpe-modal-content">
          <!-- Content rendered by APP.ui.renderRPEModal() -->
        </div>
      </div>
    </div>
    <!-- V28.1: Simplified Manual Copy Modal - Textarea + Copy Button Only -->
    <div
      id="library-modal"
      class="fixed inset-0 bg-black/95 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm"
    >
      <div
        class="glass-panel w-full max-w-2xl rounded-2xl border border-white/10 p-5 flex flex-col fade-in max-h-[90vh] overflow-y-auto"
      >
        <!-- Header -->
        <div
          class="flex justify-between items-center mb-4 pb-3 border-b border-white/10"
        >
          <h3 class="font-bold text-white flex items-center gap-2">
            <i class="fa-solid fa-copy text-emerald-400"></i>
            Copy Text
          </h3>
          <button
            onclick="APP.ui.closeModal('library')"
            class="text-slate-400 hover:text-white transition"
          >
            <i class="fa-solid fa-xmark fa-lg"></i>
          </button>
        </div>

        <!-- Large Textarea -->
        <div class="flex-1 mb-4">
          <textarea
            id="ai-input"
            class="w-full h-full glass-input text-emerald-400 font-mono text-xs p-4 rounded-xl border border-white/10 focus:border-emerald-500 resize-none min-h-[400px]"
            placeholder="Text will appear here..."
            readonly
          ></textarea>
        </div>

        <!-- Copy Button -->
        <button
          onclick="APP.ui.copyTextFromLibraryModal()"
          class="w-full bg-gradient-to-r from-emerald-600 to-green-600 hover:from-emerald-500 hover:to-green-500 text-white font-bold py-4 rounded-xl flex items-center justify-center gap-3 shadow-lg transition active:scale-95"
        >
          <i class="fa-solid fa-copy"></i>
          <span>COPY TEXT</span>
        </button>

        <!-- Helper Text -->
        <p class="text-xs text-slate-500 text-center mt-3 italic">
          Tap the button to copy, or manually select text above
        </p>
      </div>
    </div>
    <div
      id="calc-modal"
      class="fixed inset-0 bg-black/95 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm"
    >
      <div
        class="glass-panel w-full max-w-md rounded-2xl border border-white/10 p-5 fade-in overflow-y-auto"
      >
        <div class="flex justify-between items-center mb-4">
          <h3 class="font-bold text-white">
            <i class="fa-solid fa-calculator text-yellow-400 mr-2"></i>Warm-Up &
            Plates
          </h3>
          <button onclick="APP.ui.closeModal('calc')" class="text-slate-400">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
        <div class="flex gap-2 mb-4 items-center justify-center">
          <span class="text-slate-400 text-xs">Target:</span
          ><span id="calc-target" class="text-2xl font-bold text-white">0</span
          ><span class="text-slate-400 text-xs">kg</span>
        </div>
        <div class="flex justify-center mb-4">
          <span
            id="calc-type-badge"
            class="px-2 py-0.5 rounded text-[10px] font-bold uppercase bg-slate-700 text-slate-400"
            >Standard</span
          >
        </div>
        <div
          id="calc-steps"
          class="space-y-2 max-h-[300px] overflow-y-auto no-scrollbar"
        ></div>
        <p class="text-[10px] text-slate-500 text-center mt-3 italic">
          Rincian pelat per sisi (Asumsi bar 20kg).
        </p>
      </div>
    </div>
    <div
      id="stats-modal"
      class="fixed inset-0 bg-black/95 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm"
    >
      <div
        class="glass-panel w-[95%] max-w-md rounded-2xl border border-white/10 p-5 flex flex-col max-h-[90vh] fade-in overflow-y-auto"
      >
        <div
          class="flex justify-between items-center mb-4 border-b border-white/10 pb-3"
        >
          <h3 class="font-bold text-white">Clinical Analytics</h3>
          <button onclick="APP.ui.closeModal('stats')" class="text-slate-400">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
        <div id="exercise-selector-container" class="mb-4">
          <select
            id="stats-select"
            onchange="APP.stats.updateChart()"
            class="w-full glass-input text-white text-sm p-3 rounded-xl border border-white/10 mt-1"
          ></select>
        </div>
        <div class="mb-3">
          <div class="flex gap-2 justify-center mb-2">
            <button
              id="tab-dashboard"
              onclick="APP.stats.switchTab('dashboard')"
              class="tab-btn active w-12 h-12 flex items-center justify-center text-xl rounded-lg transition-all"
            >
              üìä
            </button>
            <button
              id="tab-chart"
              onclick="APP.stats.switchTab('chart')"
              class="tab-btn inactive w-12 h-12 flex items-center justify-center text-xl rounded-lg transition-all"
            >
              üìà
            </button>
            <button
              id="tab-table"
              onclick="APP.stats.switchTab('table')"
              class="tab-btn inactive w-12 h-12 flex items-center justify-center text-xl rounded-lg transition-all"
            >
              üìã
            </button>
            <button
              id="tab-bodyparts"
              onclick="APP.stats.switchTab('bodyparts')"
              class="tab-btn inactive w-12 h-12 flex items-center justify-center text-xl rounded-lg transition-all"
            >
              üí™
            </button>
          </div>

          <div class="text-center">
            <span
              id="active-tab-label"
              class="text-xs font-bold text-emerald-400 uppercase tracking-wider"
            >
              Dashboard
            </span>
          </div>
        </div>
        <div
          id="stats-dashboard-view"
          class="glass-panel p-4 rounded-xl border border-white/10 flex-1 min-h-[350px] overflow-y-auto no-scrollbar mb-4"
        >
          <div class="mb-6">
            <h3
              class="text-xs text-slate-400 uppercase font-bold mb-3 flex items-center gap-2"
            >
              <i class="fa-solid fa-calendar-week"></i> This Week vs Last Week
            </h3>
            <div class="grid grid-cols-2 gap-3">
              <div
                class="glass-card p-3 rounded-lg border border-white/5"
              >
                <div class="text-[10px] text-slate-400 mb-1">Total Volume</div>
                <div class="flex items-baseline gap-2">
                  <span
                    id="dash-volume-current"
                    class="text-2xl font-bold text-white"
                    >0</span
                  >
                  <span class="text-xs text-slate-500">kg</span>
                </div>
                <div id="dash-volume-diff" class="text-xs font-bold mt-1">
                  <span class="text-slate-400">No data</span>
                </div>
              </div>

              <div
                class="glass-card p-3 rounded-lg border border-white/5"
              >
                <div class="text-[10px] text-slate-400 mb-1">Avg RPE</div>
                <div class="flex items-baseline gap-2">
                  <span
                    id="dash-rpe-current"
                    class="text-2xl font-bold text-white"
                    >0</span
                  >
                </div>
                <div id="dash-rpe-diff" class="text-xs font-bold mt-1">
                  <span class="text-slate-400">No data</span>
                </div>
              </div>

              <div
                class="glass-card p-3 rounded-lg border border-white/5"
              >
                <div class="text-[10px] text-slate-400 mb-1">Sessions</div>
                <div class="flex items-baseline gap-2">
                  <span
                    id="dash-sessions-current"
                    class="text-2xl font-bold text-white"
                    >0</span
                  >
                </div>
                <div id="dash-sessions-diff" class="text-xs font-bold mt-1">
                  <span class="text-slate-400">No data</span>
                </div>
              </div>

              <div
                class="glass-card p-3 rounded-lg border border-white/5"
              >
                <div class="text-[10px] text-slate-400 mb-1">Tonnage</div>
                <div class="flex items-baseline gap-2">
                  <span
                    id="dash-tonnage-current"
                    class="text-2xl font-bold text-white"
                    >0</span
                  >
                  <span class="text-xs text-slate-500">kg</span>
                </div>
                <div id="dash-tonnage-diff" class="text-xs font-bold mt-1">
                  <span class="text-slate-400">No data</span>
                </div>
              </div>
            </div>
          </div>

          <div class="mb-6">
            <h3
              class="text-xs text-slate-400 uppercase font-bold mb-3 flex items-center gap-2"
            >
              <i class="fa-solid fa-trophy"></i> Top Gainers (Volume %)
            </h3>
            <div id="dash-top-gainers" class="space-y-2">
              <p class="text-xs text-slate-500 italic">
                Complete more sessions to see gainers.
              </p>
            </div>
          </div>

          <div id="dash-fatigue-alert" class="hidden">
            <div class="bg-red-900/20 border border-red-900/50 rounded-lg p-3">
              <div class="flex items-start gap-2">
                <i
                  class="fa-solid fa-triangle-exclamation text-red-400 mt-0.5"
                ></i>
                <div>
                  <div class="text-xs font-bold text-red-400 mb-1">
                    Fatigue Alert
                  </div>
                  <div id="dash-fatigue-message" class="text-xs text-slate-300">
                    High RPE detected. Consider rest.
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div
          id="stats-chart-view"
          class="glass-panel p-2 rounded-xl border border-white/10 flex-1 min-h-[250px] relative mb-4"
        >
          <canvas id="progressChart"></canvas>
          <div
            id="no-data-msg"
            class="absolute inset-0 flex items-center justify-center text-slate-500 text-xs hidden"
          >
            No Data.
          </div>
        </div>
        <div
          id="stats-table-view"
          class="glass-panel p-2 rounded-xl border border-white/10 flex-1 min-h-[250px] relative mb-4 hidden overflow-y-auto no-scrollbar"
        >
          <table class="hist-table">
            <thead>
              <tr>
                <th>TGL</th>
                <th>BEBAN</th>
                <th>REPS</th>
                <th>RPE</th>
                <th>VOL</th>
              </tr>
            </thead>
            <tbody id="hist-table-body"></tbody>
          </table>
        </div>
        <div
          id="stats-bodyparts-view"
          class="glass-panel p-4 rounded-xl border border-white/10 flex-1 min-h-[350px] overflow-y-auto no-scrollbar mb-4 hidden"
        >
          <div class="mb-4">
            <!-- üìç INSERT THIS BEFORE <select id="bodypart-period"> -->
            <div class="mb-4">
              <div class="flex gap-2 justify-center">
                <button
                  id="view-combined-btn"
                  onclick="APP.stats.setBodyPartView('combined')"
                  class="px-4 py-2 text-xs font-bold rounded-lg transition-all duration-300 bg-emerald-600 text-white"
                >
                  üìä Combined View
                </button>
                <button
                  id="view-split-btn"
                  onclick="APP.stats.setBodyPartView('split')"
                  class="px-4 py-2 text-xs font-bold rounded-lg transition-all duration-300 bg-slate-700 text-slate-400"
                >
                  üîÄ Split View (Upper/Lower)
                </button>
              </div>
              <p class="text-[9px] text-slate-500 text-center mt-2 italic">
                Combined: All muscles vs Legs baseline | Split: Fair comparison
                per region
              </p>
            </div>
            <select
              id="bodypart-period"
              onchange="APP.stats.updateBodyParts()"
              class="w-full glass-input text-white text-xs p-2 rounded border border-white/10"
            >
              <option value="4">Last 4 Weeks</option>
              <option value="8">Last 8 Weeks</option>
              <option value="12">Last 12 Weeks</option>
            </select>
          </div>

          <div class="mb-6">
            <h3 class="text-xs text-slate-400 uppercase font-bold mb-3">
              Volume by Muscle Group
            </h3>
            <div id="bodypart-bars" class="space-y-3">
              <p class="text-xs text-slate-500 italic">Loading...</p>
            </div>
          </div>

          <div id="bodypart-imbalance" class="hidden">
            <div
              class="bg-yellow-900/20 border border-yellow-900/50 rounded-lg p-3"
            >
              <div class="flex items-start gap-2">
                <i
                  class="fa-solid fa-scale-unbalanced text-yellow-400 mt-0.5"
                ></i>
                <div>
                  <div class="text-xs font-bold text-yellow-400 mb-1">
                    Imbalance Detected
                  </div>
                  <div
                    id="bodypart-imbalance-message"
                    class="text-xs text-slate-300"
                  >
                    Checking balance...
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- V29.0: ADVANCED RATIOS SECTION -->
          <div class="mt-6">
            <h3 class="text-xs text-slate-400 uppercase font-bold mb-3 flex items-center gap-2">
              <i class="fa-solid fa-chart-line"></i> Advanced Analytics
              <span class="text-[9px] font-normal text-slate-500">(V29.0)</span>
            </h3>

            <!-- Ratio Cards Container -->
            <div id="advanced-ratios-container" class="space-y-3">
              <!-- Cards will be rendered by renderAdvancedRatios() -->
            </div>
          </div>

          <!-- V29.0: TRAINING INSIGHTS PANEL -->
          <div class="mt-6">
            <h3 class="text-xs text-slate-400 uppercase font-bold mb-3 flex items-center gap-2">
              <i class="fa-solid fa-lightbulb"></i> Clinical Insights
              <span class="text-[9px] font-normal text-slate-500">(Evidence-Based)</span>
            </h3>

            <!-- Insights Container -->
            <div id="insights-container" class="space-y-2">
              <!-- Insight cards will be rendered by renderInsightCards() -->
            </div>
          </div>

        </div>
        <div id="vital-signs" class="grid grid-cols-3 gap-2 text-center hidden">
          <div class="glass-card p-2 rounded border border-white/5">
            <div class="text-[10px] text-slate-400 uppercase">PR</div>
            <div class="text-lg font-bold text-emerald-400" id="stat-pr">
              --
            </div>
          </div>
          <div class="glass-card p-2 rounded border border-white/5">
            <div class="text-[10px] text-slate-400 uppercase">Vol Avg</div>
            <div class="text-lg font-bold text-blue-400" id="stat-vol">--</div>
          </div>
          <div class="glass-card p-2 rounded border border-white/5">
            <div class="text-[10px] text-slate-400 uppercase">Count</div>
            <div class="text-lg font-bold text-white" id="stat-count">--</div>
          </div>
        </div>

      </div>
    </div>
    <div
      id="profile-modal"
      class="fixed inset-0 bg-black/90 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm"
    >
      <div
        class="glass-panel w-[95%] max-w-md rounded-2xl border border-white/10 p-5 space-y-4 fade-in overflow-y-auto max-h-[90vh]"
      >
        <div class="flex justify-between">
          <h3 class="font-bold text-white">Profile</h3>
          <button onclick="APP.ui.closeModal('profile')" class="text-slate-400">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
        <div class="space-y-3">
          <div class="grid grid-cols-2 gap-3">
            <div>
              <span class="text-[10px] text-slate-400">Nama</span>
              <input
                type="text"
                id="prof-name"
                class="w-full p-2 glass-input rounded text-white text-sm"
                placeholder="Masukkan nama..."
              />
            </div>
            <div>
              <span class="text-[10px] text-slate-400">Tinggi (cm)</span>
              <input
                type="number"
                id="prof-height"
                class="w-full p-2 glass-input rounded text-white text-sm"
                placeholder="170"
              />
            </div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div>
              <span class="text-[10px] text-slate-400">Usia</span>
              <input
                type="number"
                id="prof-age"
                class="w-full p-2 glass-input rounded text-white text-sm"
                placeholder="25"
              />
            </div>
            <div>
              <span class="text-[10px] text-slate-400">Gender</span>
              <select
                id="prof-gender"
                class="w-full p-2 glass-input rounded text-white text-sm"
              >
                <option value="male">Pria</option>
                <option value="female">Wanita</option>
              </select>
            </div>
          </div>
          <div>
            <span class="text-[10px] text-slate-400">Aktivitas</span>
            <select
              id="prof-active"
              class="w-full p-2 glass-input rounded text-white text-sm"
            >
              <option value="1.2">Sedentary (Tidak ada olahraga)</option>
              <option value="1.375">Light (1-3 hari/minggu)</option>
              <option value="1.55">Moderate (3-5 hari/minggu)</option>
              <option value="1.725">Active (6-7 hari/minggu)</option>
            </select>
          </div>
          <button
            onclick="APP.data.saveProfile()"
            class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-lg transition active:scale-95"
          >
            Simpan Profil
          </button>
        </div>
        <div
          class="glass-panel p-4 rounded-xl border border-white/10 mb-4"
        >
          <h4
            class="text-xs font-bold text-slate-400 mb-2 uppercase flex justify-between"
          >
            <span
              ><i class="fa-solid fa-database mr-1"></i> Storage Status</span
            >
            <button
              onclick="APP.showStorageStats()"
              class="text-blue-400 hover:text-blue-300"
            >
              <i class="fa-solid fa-rotate"></i>
            </button>
          </h4>
          <div id="storage-stats" class="grid grid-cols-2 gap-2 text-xs">
            <div class="glass-card p-2 rounded">
              <div class="text-slate-500 text-[10px]">Items</div>
              <div class="text-white font-bold" id="stat-items">--</div>
            </div>
            <div class="glass-card p-2 rounded">
              <div class="text-slate-500 text-[10px]">Size</div>
              <div class="text-white font-bold" id="stat-size">--</div>
            </div>
            <div class="glass-card p-2 rounded col-span-2">
              <div class="text-slate-500 text-[10px]">Usage</div>
              <div class="flex items-center gap-2">
                <div
                  class="flex-1 bg-white/10 rounded-full h-2 overflow-hidden"
                >
                  <div
                    id="usage-bar"
                    class="bg-emerald-500 h-full transition-all"
                    style="width: 0%"
                  ></div>
                </div>
                <span class="text-white font-bold text-[10px]" id="stat-usage"
                  >0%</span
                >
              </div>
            </div>
          </div>
        </div>

        <div
          class="mt-6 p-4 rounded-xl border border-teal-500/40 bg-teal-900/20"
        >
          <div
            class="mb-4 p-4 bg-indigo-900/30 rounded-2xl border border-indigo-500/30 shadow-inner"
          >
            <h3
              class="text-[10px] font-bold text-indigo-400 mb-3 uppercase tracking-widest flex items-center"
            >
              <i class="fa-solid fa-cloud mr-2"></i> Cloud Sync (G-Drive)
            </h3>
            <div class="grid grid-cols-2 gap-2">
              <button
                onclick="syncToCloud()"
                class="bg-indigo-600 hover:bg-indigo-500 text-white py-3 rounded-xl font-bold text-xs transition active:scale-95 flex flex-col items-center gap-1"
              >
                <i class="fa-solid fa-cloud-arrow-up text-base"></i> Backup
              </button>
              <button
                onclick="restoreFromCloud()"
                class="bg-slate-700 hover:bg-slate-600 text-white py-3 rounded-xl font-bold text-xs transition active:scale-95 flex flex-col items-center gap-1"
              >
                <i class="fa-solid fa-cloud-arrow-down text-base"></i> Restore
              </button>
            </div>
            <p
              class="text-[9px] text-slate-500 mt-2 text-center italic leading-tight"
            >
              Backup disimpan aman di AppData Google Drive.
            </p>
          </div>
          <div class="border-t border-slate-700 pt-3 mt-2">
            <div class="grid grid-cols-2 gap-4">
              <button
                onclick="APP.data.exportData()"
                class="bg-slate-700 text-emerald-400 text-xs py-2 rounded"
              >
                Backup Manual</button
              ><label
                class="bg-slate-700 text-blue-400 text-xs py-2 rounded text-center cursor-pointer"
                >Restore Manual<input
                  type="file"
                  id="import-file"
                  class="hidden"
                  onchange="APP.data.importData(this)"
              /></label>
            </div>
          </div>
        </div>
        <div class="mt-6 p-4 rounded-xl border border-red-900/30 bg-red-950/20">
          <h4
            class="text-red-400 font-bold text-[10px] mb-2 uppercase tracking-wide"
          >
            <i class="fa-solid fa-triangle-exclamation mr-1"></i> Data Danger
            Zone
          </h4>
          <div class="grid grid-cols-1 gap-2">
            <button
              onclick="APP.data.deleteLogs('today')"
              class="w-full bg-slate-700 text-slate-300 text-xs py-2 rounded hover:bg-red-900/50 hover:text-red-400 transition text-left px-3 flex justify-between items-center"
            >
              <span>Hapus Log Hari Ini</span> <i class="fa-solid fa-trash"></i>
            </button>
            <div class="flex gap-2">
              <input
                type="date"
                id="del-date-picker"
                class="glass-input text-white text-xs p-2 rounded border border-white/10 flex-1"
              />
              <button
                onclick="APP.data.deleteLogs('date')"
                class="bg-slate-700 text-slate-300 text-xs px-3 rounded hover:bg-red-900/50 hover:text-red-400 transition whitespace-nowrap"
              >
                Hapus Tgl Ini
              </button>
            </div>
            <button
              onclick="APP.data.deleteLogs('all')"
              class="w-full bg-red-900/30 border border-red-900/50 text-red-400 font-bold text-xs py-3 rounded mt-2 hover:bg-red-900 hover:text-white transition flex items-center justify-center gap-2 shadow-lg shadow-red-900/10"
            >
              <i class="fa-solid fa-radiation"></i> RESET TOTAL (FRESH START)
            </button>
          </div>
        </div>
      </div>
    </div>
    <div
      id="nutrition-modal"
      class="fixed inset-0 bg-black/90 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm"
    >
      <div
        class="glass-panel w-[95%] max-w-md rounded-2xl border border-white/10 p-5 space-y-4 fade-in overflow-y-auto max-h-[90vh]"
      >
        <div class="flex justify-between border-b border-white/10 pb-3">
          <h3 class="font-bold text-white flex items-center gap-2">
            <i class="fa-solid fa-fire text-orange-500"></i>
            Daily Calories & Macros
          </h3>
          <button onclick="APP.ui.closeModal('nutrition')" class="text-slate-400 hover:text-white transition-colors">
            <i class="fa-solid fa-xmark fa-lg"></i>
          </button>
        </div>

        <div class="space-y-4">
          <!-- LEGACY RESULTS SECTION -->
          <div class="text-center p-2">
            <div class="mb-1">
              <span class="text-slate-500 text-[10px] uppercase tracking-[0.2em] font-black">
                Kebutuhan Kalori Harian
              </span>
            </div>
            <div class="flex items-baseline justify-center gap-1 mb-5">
              <span id="nut-tdee-val" class="text-5xl font-black text-orange-400 tracking-tighter">
                --
              </span>
              <span class="text-slate-500 text-xs font-bold italic">
                Kkal/Hari
              </span>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-3 text-xs">
            <div class="bg-emerald-500/10 border border-emerald-500/20 p-3 rounded-xl transition-all hover:border-emerald-500/40 text-center">
              <span class="text-emerald-500 font-black uppercase text-[9px] block mb-1">
                Bulking
              </span>
              <div class="text-emerald-400 font-bold">
                <span id="nut-bulk-val" class="text-lg">--</span>
                <span class="opacity-60">Kkal (+300)</span>
              </div>
            </div>
            <div class="bg-red-500/10 border border-red-500/20 p-3 rounded-xl transition-all hover:border-red-500/40 text-center">
              <span class="text-red-400 font-black uppercase text-[9px] block mb-1">
                Cutting
              </span>
              <div class="text-red-400 font-bold">
                <span id="nut-cut-val" class="text-lg">--</span>
                <span class="opacity-60">Kkal (-500)</span>
              </div>
            </div>
          </div>

          <!-- MACROS EXPANSION -->
          <div class="p-3 bg-indigo-900/20 border border-indigo-500/30 rounded-xl">
            <div class="flex justify-between items-center mb-2">
                <h4 class="text-[10px] font-bold text-indigo-300 uppercase underline decoration-indigo-500/50 underline-offset-4">
                  Estimasi Makro
                </h4>
                <span class="text-[8px] bg-indigo-600 text-white px-1.5 py-0.5 rounded-full font-black uppercase tracking-tighter">
                  High Protein
                </span>
            </div>
            <div class="grid grid-cols-3 gap-2 text-center">
                <div class="bg-white/5 p-1.5 rounded-lg border border-white/5">
                    <div class="text-[9px] text-slate-500 uppercase font-bold">Protein</div>
                    <div class="text-xs font-black text-white"><span id="nut-pro-val">--</span>g</div>
                </div>
                <div class="bg-white/5 p-1.5 rounded-lg border border-white/5">
                    <div class="text-[9px] text-slate-500 uppercase font-bold">Lemak</div>
                    <div class="text-xs font-black text-white"><span id="nut-fat-val">--</span>g</div>
                </div>
                <div class="bg-white/5 p-1.5 rounded-lg border border-white/5">
                    <div class="text-[9px] text-slate-500 uppercase font-bold">Karbo</div>
                    <div class="text-xs font-black text-white"><span id="nut-carb-val">--</span>g</div>
                </div>
            </div>
          </div>
          
          <p class="text-[9px] text-slate-500 text-center italic opacity-70">
            Atur tinggi, usia, gender, dan aktivitas di menu Profile untuk update data ini.
          </p>
        </div>
      </div>
    </div>

    <div
      id="weight-modal"
      class="fixed inset-0 bg-black/90 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm"
    >
      <div
        class="glass-panel w-[95%] max-w-md rounded-2xl border border-white/10 p-5 fade-in"
      >
        <div class="flex justify-between mb-4">
          <h3 class="font-bold text-white">Weight</h3>
          <button onclick="APP.ui.closeModal('weight')" class="text-slate-400">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
        <div class="flex gap-2 mb-4">
          <input
            type="number"
            id="new-weight"
            step="0.1"
            placeholder="00.0"
            class="flex-1 glass-input text-white text-center font-bold rounded-xl border border-white/10"
          />
          <button
            onclick="APP.data.addWeight()"
            class="bg-emerald-600 hover:bg-emerald-500 text-white w-12 rounded-xl flex items-center justify-center transition active:scale-95 shadow-lg shadow-emerald-500/20"
          >
            <i class="fa-solid fa-plus"></i>
          </button>
        </div>
        <div
          id="weight-list"
          class="space-y-2 max-h-60 overflow-y-auto no-scrollbar"
        ></div>
      </div>
    </div>
    <div
      id="exercise-picker-modal"
      class="fixed inset-0 bg-black/95 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm"
      onclick="if(event.target.id === 'exercise-picker-modal') APP.ui.closeModal('exercise-picker')"
    >
      <div
        class="glass-panel w-[95%] max-w-2xl rounded-2xl border border-white/10 p-5 flex flex-col fade-in max-h-[90vh] min-h-[500px]"
      >
        <div
          class="flex justify-between items-center mb-4 pb-2 border-b border-slate-700"
        >
          <h3 class="font-bold text-white text-lg">
            <i class="fa-solid fa-dumbbell text-emerald-400 mr-2"></i>Exercise
            Library
          </h3>
          <button
            onclick="APP.ui.closeModal('exercise-picker')"
            class="text-slate-400 hover:text-white cursor-pointer"
          >
            <i class="fa-solid fa-xmark fa-lg"></i>
          </button>
        </div>
        <div class="mb-3">
          <input
            type="text"
            id="exercise-search"
            placeholder="Cari exercise..."
            class="w-full glass-input border border-white/10 text-white text-sm p-2 rounded mb-2"
            onkeyup="APP.ui.filterExercises()"
          />
          <div class="flex gap-2 flex-wrap" id="category-filter">
            <button
              onclick="APP.ui.filterByCategory('all')"
              class="text-[10px] px-2 py-1 rounded bg-emerald-600 text-white font-bold active-category"
            >
              All
            </button>
          </div>
        </div>
        <div
          id="picker-exercise-list"
          class="space-y-2 overflow-y-auto no-scrollbar flex-1 mb-3"
        ></div>
        <div class="pt-3 border-t border-slate-700">
          <button
            onclick="APP.ui.closeModal('exercise-picker')"
            class="w-full bg-slate-700 hover:bg-slate-600 text-slate-300 py-2 rounded-lg font-bold text-sm transition"
          >
            <i class="fa-solid fa-arrow-left mr-2"></i>Kembali
          </button>
        </div>
      </div>
    </div>
    <div
      id="bio-modal"
      class="fixed inset-0 bg-black/90 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm"
    >
      <div
        class="glass-panel w-[95%] max-w-md rounded-2xl border border-white/10 p-6 max-h-[80vh] flex flex-col fade-in"
      >
        <h3
          class="font-bold text-white text-lg mb-4 text-emerald-400"
          id="bio-title"
        ></h3>
        <div class="overflow-y-auto pr-2 mb-4 no-scrollbar">
          <p
            id="bio-text"
            class="text-slate-300 text-sm whitespace-pre-line leading-relaxed"
          ></p>
        </div>
        <button
          onclick="APP.ui.closeModal('bio')"
          class="w-full bg-slate-700 text-white py-3 rounded-xl font-bold"
        >
          Tutup
        </button>
      </div>
    </div>
    <div
      id="history-modal"
      class="fixed inset-0 bg-black/90 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm"
    >
      <div
        class="glass-panel w-[95%] max-w-md rounded-2xl border border-white/10 p-5 max-h-[80vh] flex flex-col fade-in"
      >
        <div class="flex justify-between border-b border-slate-700 pb-2 mb-2">
          <h3 class="font-bold text-white" id="hist-title">History</h3>
          <button onclick="APP.ui.closeModal('history')" class="text-slate-400">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
        <div
          id="hist-content"
          class="overflow-y-auto space-y-2 no-scrollbar"
        ></div>
      </div>
    </div>
    <div
      id="calendar-modal"
      class="fixed inset-0 bg-black/95 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm"
    >
      <div
        class="glass-panel w-[95%] max-w-md rounded-2xl border border-white/10 p-5 flex flex-col fade-in max-h-[90vh]"
      >
        <div
          class="flex justify-between items-center mb-4 pb-2 border-b border-slate-700"
        >
          <h3 class="font-bold text-white">
            <i class="fa-solid fa-calendar-days text-emerald-400 mr-2"></i
            >Jurnal & Performa
          </h3>
          <button
            onclick="APP.ui.closeModal('calendar')"
            class="text-slate-400"
          >
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
        <div class="flex justify-between items-center mb-4">
          <button
            onclick="APP.ui.changeMonth(-1)"
            class="text-slate-400 hover:text-white px-2"
          >
            <i class="fa-solid fa-chevron-left"></i>
          </button>
          <h4 id="cal-month-year" class="text-white font-bold text-sm"></h4>
          <button
            onclick="APP.ui.changeMonth(1)"
            class="text-slate-400 hover:text-white px-2"
          >
            <i class="fa-solid fa-chevron-right"></i>
          </button>
        </div>
        <div
          class="grid grid-cols-7 gap-1 mb-2 text-center text-[10px] text-slate-500 font-bold uppercase"
        >
          <div>Min</div>
          <div>Sen</div>
          <div>Sel</div>
          <div>Rab</div>
          <div>Kam</div>
          <div>Jum</div>
          <div>Sab</div>
        </div>
        <div id="cal-grid" class="grid grid-cols-7 gap-1 mb-4"></div>
        <div
          id="cal-details"
          class="glass-panel p-3 rounded-lg border border-white/10 min-h-[140px] flex flex-col justify-center overflow-y-auto no-scrollbar"
        >
          <div class="text-center text-slate-500 opacity-70">
            <i class="fa-solid fa-hand-pointer mb-2 text-xl"></i>
            <p class="text-xs italic">
              Klik tanggal hijau untuk melihat detail.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- AI COMMAND CENTER MODAL -->
    <div
      id="ai-command-center-modal"
      class="fixed inset-0 bg-black/95 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm"
    >
      <div
        class="glass-panel w-[95%] max-w-2xl rounded-2xl border border-purple-500/50 p-5 flex flex-col fade-in max-h-[90vh]"
      >
        <!-- Header -->
        <div
          class="flex justify-between items-center mb-4 pb-3 border-b border-slate-700"
        >
          <h3 class="font-bold text-white text-lg">
            <i class="fa-solid fa-microchip text-purple-400 mr-2"></i>AI Command Center
          </h3>
          <button
            onclick="APP.ui.closeAICommandCenter()"
            class="text-slate-400 hover:text-white transition"
          >
            <i class="fa-solid fa-xmark fa-lg"></i>
          </button>
        </div>

        <!-- Mode Selector -->
        <div class="mb-4">
          <label class="text-xs text-slate-400 font-bold uppercase block mb-2">
            Mode
          </label>
          <select
            id="ai-mode-selector"
            onchange="APP.ui.switchAIMode(this.value)"
            class="w-full glass-input border border-white/10 text-white text-sm p-3 rounded-lg focus:border-purple-500 transition"
          >
            <option value="context">üì§ Ambil Konteks (Export)</option>
            <option value="import">üì• Import Resep (JSON)</option>
            <option value="library">üìö Resep Tersimpan</option>
            <option value="backup">üíæ Backup & Restore</option>
            <option value="prompt-manager">üéØ Kelola Prompt AI</option>
          </select>
        </div>

        <!-- Dynamic Content Area -->
        <div id="ai-content-area" class="flex-1 overflow-y-auto no-scrollbar">
          <!-- Content injected by switchAIMode() -->
        </div>
      </div>
    </div>

    <!-- ========================================== -->
    <!-- V30.0: GLOBAL TOOLTIP CONTAINER            -->
    <!-- Must be at body level for proper z-index   -->
    <!-- ========================================== -->
    <div id="tooltip-container" class="hidden fixed bg-slate-900/95 backdrop-blur-sm text-white text-xs rounded-xl shadow-2xl p-4 max-w-[280px] border border-slate-600" style="z-index: 99999; pointer-events: none;">
      <div id="tooltip-content"></div>
    </div>

    <!-- ========================================== -->
    <!-- MODULE SCRIPTS (LOAD ORDER CRITICAL!)      -->
    <!-- ========================================== -->
    
    <script src="exercises-library.js"></script>
    <script src="js/constants.js"></script>
    <script src="js/core.js"></script>
    <script src="js/validation.js"></script>
    <script src="js/data.js"></script>
    <script src="js/safety.js"></script>
    <script src="js/stats.js"></script>
    <script src="js/session.js"></script>
    <script src="js/cardio.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/ai-bridge.js"></script>
    <script src="js/debug.js"></script>
    <script src="js/nav.js"></script>
    <script src="js/cloud.js"></script>

    <!-- ========================================== -->
    <!-- MINIMAL INIT (ONLY DOM READY LISTENER)     -->
    <!-- ========================================== -->
    
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        if (window.APP && APP.init) {
          APP.init();
        } else {
          console.error("APP.init not found!");
        }
      });

      // Service Worker Registration
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("sw.js")
            .then((reg) => console.log("SW Registered"))
            .catch((err) => console.log("SW Registration Failed", err));
        });
      }
    </script>
  </body>
</html>
